<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../../displayToc.js"></script>
<script language="JavaScript" src="../../../tocParas.js"></script>
<script language="JavaScript" src="../../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../../scineplex.css">
<title></title>
<link rel="stylesheet" href="../../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:support@ActiveState.com" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#VERSION">VERSION</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#CLASSES">CLASSES</a></li>
  <li><a href="#OBJECTS">OBJECTS</a>
    <ul>
      <li><a href="#Object-Creation">Object Creation</a></li>
      <li><a href="#Object-IDs">Object IDs</a></li>
    </ul>
  </li>
  <li><a href="#ATTRIBUTES">ATTRIBUTES</a></li>
  <li><a href="#FIELDS">FIELDS</a>
    <ul>
      <li><a href="#Field-Declarations">Field Declarations</a></li>
      <li><a href="#Getting-Data">Getting Data</a></li>
      <li><a href="#Setting-Data">Setting Data</a></li>
    </ul>
  </li>
  <li><a href="#OBJECT-INITIALIZATION">OBJECT INITIALIZATION</a>
    <ul>
      <li><a href="#Field-Specific-Parameters">Field-Specific Parameters</a></li>
      <li><a href="#Object-Initialization-Subroutines">Object Initialization Subroutines</a></li>
      <li><a href="#Mandatory-Parameters">Mandatory Parameters</a></li>
      <li><a href="#Default-Values">Default Values</a>
        <ul>
          <li><a href="#Generated-Default-Values">Generated Default Values</a></li>
          <li><a href="#Sequential-defaults">Sequential defaults</a></li>
        </ul>
      </li>
      <li><a href="#Parameter-Name-Matching">Parameter Name Matching</a></li>
      <li><a href="#Object-Pre-initialization">Object Pre-initialization</a></li>
      <li><a href="#Initialization-Sequence">Initialization Sequence</a></li>
      <li><a href="#Unhandled-Parameters">Unhandled Parameters</a></li>
      <li><a href="#Modifying">Modifying </a></li>
    </ul>
  </li>
  <li><a href="#ACCESSOR-GENERATION">ACCESSOR GENERATION</a>
    <ul>
      <li><a href="#Basic-Accessors">Basic Accessors</a></li>
      <li><a href="#Set-Accessor-Return-Value">Set Accessor Return Value</a></li>
      <li><a href="#Method-Chaining">Method Chaining</a></li>
      <li><a href="#lvalue-Accessors">:lvalue Accessors</a></li>
    </ul>
  </li>
  <li><a href="#ALL-IN-ONE">ALL-IN-ONE</a></li>
  <li><a href="#READONLY-FIELDS">READONLY FIELDS</a></li>
  <li><a href="#DELEGATORS">DELEGATORS</a></li>
  <li><a href="#PERMISSIONS">PERMISSIONS</a>
    <ul>
      <li><a href="#Restricted-and-Private-Accessors">Restricted and Private Accessors</a></li>
      <li><a href="#Restricted-and-Private-Methods">Restricted and Private Methods</a></li>
      <li><a href="#Exemptions">Exemptions</a></li>
      <li><a href="#Hidden-Methods">Hidden Methods</a></li>
      <li><a href="#Restricted-and-Private-Classes">Restricted and Private Classes</a></li>
    </ul>
  </li>
  <li><a href="#TYPE-CHECKING">TYPE CHECKING</a>
    <ul>
      <li><a href="#Field-Type-Checking">Field Type Checking</a></li>
      <li><a href="#Type-Checking-on-Parameters">Type Checking on  Parameters</a></li>
    </ul>
  </li>
  <li><a href="#CUMULATIVE-METHODS">CUMULATIVE METHODS</a></li>
  <li><a href="#CHAINED-METHODS">CHAINED METHODS</a></li>
  <li><a href="#ARGUMENT-MERGING">ARGUMENT MERGING</a></li>
  <li><a href="#ARGUMENT-VALIDATION">ARGUMENT VALIDATION</a></li>
  <li><a href="#AUTOMETHODS">AUTOMETHODS</a></li>
  <li><a href="#OBJECT-SERIALIZATION">OBJECT SERIALIZATION</a>
    <ul>
      <li><a href="#Basic-Serialization">Basic Serialization</a></li>
      <li><a href="#Storable">Storable</a></li>
    </ul>
  </li>
  <li><a href="#OBJECT-COERCION">OBJECT COERCION</a></li>
  <li><a href="#CLONING">CLONING</a>
    <ul>
      <li><a href="#Object-Cloning">Object Cloning</a></li>
      <li><a href="#Field-Cloning">Field Cloning</a></li>
    </ul>
  </li>
  <li><a href="#WEAK-FIELDS">WEAK FIELDS</a></li>
  <li><a href="#DYNAMIC-FIELD-CREATION">DYNAMIC FIELD CREATION</a></li>
  <li><a href="#RUNTIME-INHERITANCE">RUNTIME INHERITANCE</a></li>
  <li><a href="#PREPROCESSING">PREPROCESSING</a>
    <ul>
      <li><a href="#Parameter-Preprocessing">Parameter Preprocessing</a></li>
      <li><a href="#Set-Accessor-Preprocessing">Set Accessor Preprocessing</a></li>
    </ul>
  </li>
  <li><a href="#SPECIAL-PROCESSING">SPECIAL PROCESSING</a>
    <ul>
      <li><a href="#Object-ID">Object ID</a></li>
      <li><a href="#Object-Replication">Object Replication</a></li>
      <li><a href="#Object-Destruction">Object Destruction</a></li>
    </ul>
  </li>
  <li><a href="#FOREIGN-CLASS-INHERITANCE">FOREIGN CLASS INHERITANCE</a>
    <ul>
      <li><a href="#and-Fully-qualified-Method-Names"> and Fully-qualified Method Names</a></li>
    </ul>
  </li>
  <li><a href="#INTROSPECTION">INTROSPECTION</a></li>
  <li><a href="#THREAD-SUPPORT">THREAD SUPPORT</a></li>
  <li><a href="#HASH-ONLY-CLASSES">HASH ONLY CLASSES</a></li>
  <li><a href="#SECURITY">SECURITY</a></li>
  <li><a href="#ATTRIBUTE-HANDLERS">ATTRIBUTE HANDLERS</a></li>
  <li><a href="#SPECIAL-USAGE">SPECIAL USAGE</a>
    <ul>
      <li><a href="#Usage-With">Usage With </a></li>
      <li><a href="#Usage-With-and">Usage With  and </a></li>
      <li><a href="#Singleton-Classes">Singleton Classes</a></li>
    </ul>
  </li>
  <li><a href="#DIAGNOSTICS">DIAGNOSTICS</a></li>
  <li><a href="#BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</a></li>
  <li><a href="#REQUIREMENTS">REQUIREMENTS</a></li>
  <li><a href="#SEE-ALSO">SEE ALSO</a></li>
  <li><a href="#ACKNOWLEDGEMENTS">ACKNOWLEDGEMENTS</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#COPYRIGHT-AND-LICENSE">COPYRIGHT AND LICENSE</a></li>
  <li><a href="#TRANSLATIONS">TRANSLATIONS</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Object::InsideOut - Comprehensive inside-out object support module</p>

<h1 id="VERSION">VERSION</h1>

<p>This document describes Object::InsideOut version 3.98</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="comment"># Numeric field</span>
     <span class="comment">#   With combined get+set accessor</span>
     <span class="keyword">my</span> <span class="variable">@data</span>
            <span class="operator">:</span><span class="variable">Field</span>
            <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">numeric</span><span class="operator">)</span>
            <span class="operator">:</span><span class="variable">Accessor</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
 
     <span class="comment"># Takes 'INPUT' (or 'input', etc.) as a mandatory parameter to -&gt;new()</span>
     <span class="keyword">my</span> <span class="variable">%init_args</span> <span class="operator">:</span><span class="variable">InitArgs</span> <span class="operator">=</span> <span class="operator">(</span>
         <span class="string">'INPUT'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
             <span class="string">'Regex'</span>     <span class="operator">=&gt;</span> <span class="string">qr/^input$/i</span><span class="operator">,</span>
             <span class="string">'Mandatory'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>
             <span class="string">'Type'</span>      <span class="operator">=&gt;</span> <span class="string">'numeric'</span><span class="operator">,</span>
         <span class="operator">}</span><span class="operator">,</span>
     <span class="operator">);</span>
 
     <span class="comment"># Handle class-specific args as part of -&gt;new()</span>
     <span class="keyword">sub</span><span class="variable"> init :Init
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="comment"># Put 'input' parameter into 'data' field</span>
         <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">set</span><span class="operator">(\</span><span class="variable">@data</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'INPUT'</span><span class="operator">}</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">My::Class::Sub</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(My::Class)</span><span class="operator">;</span>
 
     <span class="comment"># List field</span>
     <span class="comment">#   With standard 'get_X' and 'set_X' accessors</span>
     <span class="comment">#   Takes 'INFO' as an optional list parameter to -&gt;new()</span>
     <span class="comment">#     Value automatically added to @info array</span>
     <span class="comment">#     Defaults to [ 'empty' ]</span>
     <span class="keyword">my</span> <span class="variable">@info</span>
            <span class="operator">:</span><span class="variable">Field</span>
            <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">list</span><span class="operator">)</span>
            <span class="operator">:</span><span class="variable">Standard</span><span class="operator">(</span><span class="variable">info</span><span class="operator">)</span>
            <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'INFO'</span><span class="operator">,</span> <span class="string">'Default'</span> <span class="operator">=&gt;</span> <span class="string">'empty'</span><span class="operator">);</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">Foo</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="comment"># Field containing My::Class objects</span>
     <span class="comment">#   With combined accessor</span>
     <span class="comment">#   Plus automatic parameter processing on object creation</span>
     <span class="keyword">my</span> <span class="variable">@foo</span>
            <span class="operator">:</span><span class="variable">Field</span>
            <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">My::Class</span><span class="operator">)</span>
            <span class="operator">:</span><span class="variable">All</span><span class="operator">(</span><span class="variable">foo</span><span class="operator">);</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class::Sub</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'Input'</span> <span class="operator">=&gt;</span> <span class="number">69</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">$info</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">get_info</span><span class="operator">();</span>               <span class="comment"># [ 'empty' ]</span>
 <span class="keyword">my</span> <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">();</span>                   <span class="comment"># 69</span>
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">(</span><span class="number">42</span><span class="operator">);</span>
 <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">();</span>                      <span class="comment"># 42</span>
 
 <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class::Sub</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'INFO'</span> <span class="operator">=&gt;</span> <span class="string">'help'</span><span class="operator">,</span> <span class="string">'INPUT'</span> <span class="operator">=&gt;</span> <span class="number">86</span><span class="operator">);</span>
 <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">();</span>                      <span class="comment"># 86</span>
 <span class="variable">$info</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">get_info</span><span class="operator">();</span>                  <span class="comment"># [ 'help' ]</span>
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">set_info</span><span class="operator">(</span><span class="string">qw(foo bar baz)</span><span class="operator">);</span>
 <span class="variable">$info</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">get_info</span><span class="operator">();</span>                  <span class="comment"># [ 'foo', 'bar', 'baz' ]</span>
 
 <span class="keyword">my</span> <span class="variable">$foo_obj</span> <span class="operator">=</span> <span class="variable">Foo</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'foo'</span> <span class="operator">=&gt;</span> <span class="variable">$obj</span><span class="operator">);</span>
 <span class="variable">$foo_obj</span><span class="operator">-&gt;</span><span class="variable">foo</span><span class="operator">()-&gt;</span><span class="variable">data</span><span class="operator">();</span>                   <span class="comment"># 86</span>
</code></code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This module provides comprehensive support for implementing classes using the inside-out object model.</p>

<p>Object::InsideOut implements inside-out objects as anonymous scalar references that are blessed into a class with the scalar containing the ID for the object (usually a sequence number). For Perl 5.8.3 and later, the scalar reference is set as <b>read-only</b> to prevent <i>accidental</i> modifications to the ID. Object data (i.e., fields) are stored within the class&#39;s package in either arrays indexed by the object&#39;s ID, or hashes keyed to the object&#39;s ID.</p>

<p>The virtues of the inside-out object model over the <i>blessed hash</i> object model have been extolled in detail elsewhere. See the informational links under <a href="#SEE-ALSO">&quot;SEE ALSO&quot;</a>. Briefly, inside-out objects offer the following advantages over <i>blessed hash</i> objects:</p>

<ul>

<li><p>Encapsulation</p>

<p>Object data is enclosed within the class&#39;s code and is accessible only through the class-defined interface.</p>

</li>
<li><p>Field Name Collision Avoidance</p>

<p>Inheritance using <i>blessed hash</i> classes can lead to conflicts if any classes use the same name for a field (i.e., hash key). Inside-out objects are immune to this problem because object data is stored inside each class&#39;s package, and not in the object itself.</p>

</li>
<li><p>Compile-time Name Checking</p>

<p>A common error with <i>blessed hash</i> classes is the misspelling of field names:</p>

<pre><code><code> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'coment'</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">'Say what?'</span><span class="operator">;</span>   <span class="comment"># Should be 'comment' not 'coment'</span>
</code></code></pre>

<p>As there is no compile-time checking on hash keys, such errors do not usually manifest themselves until runtime.</p>

<p>With inside-out objects, <i>text</i> hash keys are not used for accessing field data. Field names and the data index (i.e., $$self) are checked by the Perl compiler such that any typos are easily caught using <span style="white-space: nowrap;"><code><code>perl -c</code></code></span>.</p>

<pre><code><code> <span class="variable">$coment</span><span class="operator">[</span><span class="variable">$$self</span><span class="operator">]</span> <span class="operator">=</span> <span class="variable">$value</span><span class="operator">;</span>    <span class="comment"># Causes a compile-time error</span>
    <span class="comment"># or with hash-based fields</span>
 <span class="variable">$comment</span><span class="operator">{</span><span class="variable">$$self</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$value</span><span class="operator">;</span>   <span class="comment"># Also causes a compile-time error</span>
</code></code></pre>

</li>
</ul>

<p>Object::InsideOut offers all the capabilities of other inside-out object modules with the following additional key advantages:</p>

<ul>

<li><p>Speed</p>

<p>When using arrays to store object data, Object::InsideOut objects are as much as 40% faster than <i>blessed hash</i> objects for fetching and setting data, and even with hashes they are still several percent faster than <i>blessed hash</i> objects.</p>

</li>
<li><p>Threads</p>

<p>Object::InsideOut is thread safe, and thoroughly supports sharing objects between threads using <a href="../../../lib/threads/shared.html">threads::shared</a>.</p>

</li>
<li><p>Flexibility</p>

<p>Allows control over object ID specification, accessor naming, parameter name matching, and much more.</p>

</li>
<li><p>Runtime Support</p>

<p>Supports classes that may be loaded at runtime (i.e., using <span style="white-space: nowrap;"><code><code><span class="keyword">eval</span> <span class="operator">{</span> <span class="keyword">require</span> <span class="operator">...;</span> <span class="operator">};</span>
</code></code></span>). This makes it usable from within <a>mod_perl</a>, as well. Also supports additions to class hierarchies, and dynamic creation of object fields during runtime.</p>

</li>
<li><p>Exception Objects</p>

<p>Object::InsideOut uses <a href="../../../lib/Exception/Class.html">Exception::Class</a> for handling errors in an OO-compatible manner.</p>

</li>
<li><p>Object Serialization</p>

<p>Object::InsideOut has built-in support for object dumping and reloading that can be accomplished in either an automated fashion or through the use of class-supplied subroutines. Serialization using <a href="../../../lib/Storable.html">Storable</a> is also supported.</p>

</li>
<li><p>Foreign Class Inheritance</p>

<p>Object::InsideOut allows classes to inherit from foreign (i.e., non-Object::InsideOut) classes, thus allowing you to sub-class other Perl class, and access their methods from your own objects.</p>

</li>
<li><p>Introspection</p>

<p>Obtain constructor parameters and method metadata for Object::InsideOut classes.</p>

</li>
</ul>

<h1 id="CLASSES">CLASSES</h1>

<p>To use this module, each of your classes will start with <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
</code></code></span>:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Sub-classes (child classes) inherit from base classes (parent classes) by telling Object::InsideOut what the parent class is:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Sub</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(My::Parent)</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Multiple inheritance is also supported:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Project</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(My::Class Another::Class)</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Object::InsideOut acts as a replacement for the <code><code>base</code></code> pragma: It loads the parent module(s), calls their <code><code>-&gt;import()</code></code> methods, and sets up the sub-class&#39;s @ISA array. Therefore, you should not <span style="white-space: nowrap;"><code><code>use base ...</code></code></span> yourself, nor try to set up <code><code>@ISA</code></code> arrays. Further, you should not use a class&#39;s <code><code>@ISA</code></code> array to determine a class&#39;s hierarchy: See <a href="#INTROSPECTION">&quot;INTROSPECTION&quot;</a> for details on how to do this.</p>

<p>If a parent class takes parameters (e.g., symbols to be exported via <a href="#Usage-With-Exporter">Exporter</a>), enclose them in an array ref (mandatory) following the name of the parent class:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Project</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">'My::Class'</span>      <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="string">'param1'</span><span class="operator">,</span> <span class="string">'param2'</span> <span class="operator">]</span><span class="operator">,</span>
                           <span class="string">'Another::Class'</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="string">'param'</span> <span class="operator">]</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<h1 id="OBJECTS">OBJECTS</h1>

<h2 id="Object-Creation">Object Creation</h2>

<p>Objects are created using the <code><code>-&gt;new()</code></code> method which is exported by Object::InsideOut to each class, and is invoked in the following manner:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
</code></code></pre>

<p>Object::InsideOut then handles all the messy details of initializing the object in each of the classes in the invoking class&#39;s hierarchy. As such, classes do not (normally) implement their own <code><code>-&gt;new()</code></code> method.</p>

<p>Usually, object fields are initially populated with data as part of the object creation process by passing parameters to the <code><code>-&gt;new()</code></code> method. Parameters are passed in as combinations of <span style="white-space: nowrap;"><code><code>key =&gt; value</code></code></span> pairs and/or hash refs:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'param1'</span> <span class="operator">=&gt;</span> <span class="string">'value1'</span><span class="operator">);</span>
     <span class="comment"># or</span>
 <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="operator">{</span><span class="string">'param1'</span> <span class="operator">=&gt;</span> <span class="string">'value1'</span><span class="operator">}</span><span class="operator">);</span>
     <span class="comment"># or even</span>
 <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span>
     <span class="string">'param_X'</span> <span class="operator">=&gt;</span> <span class="string">'value_X'</span><span class="operator">,</span>
     <span class="string">'param_Y'</span> <span class="operator">=&gt;</span> <span class="string">'value_Y'</span><span class="operator">,</span>
     <span class="operator">{</span>
         <span class="string">'param_A'</span> <span class="operator">=&gt;</span> <span class="string">'value_A'</span><span class="operator">,</span>
         <span class="string">'param_B'</span> <span class="operator">=&gt;</span> <span class="string">'value_B'</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
     <span class="operator">{</span>
         <span class="string">'param_Q'</span> <span class="operator">=&gt;</span> <span class="string">'value_Q'</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<p>Additionally, parameters can be segregated in hash refs for specific classes:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span>
     <span class="string">'foo'</span> <span class="operator">=&gt;</span> <span class="string">'bar'</span><span class="operator">,</span>
     <span class="string">'My::Class'</span>      <span class="operator">=&gt;</span> <span class="operator">{</span> <span class="string">'param'</span> <span class="operator">=&gt;</span> <span class="string">'value'</span> <span class="operator">}</span><span class="operator">,</span>
     <span class="string">'Parent::Class'</span>  <span class="operator">=&gt;</span> <span class="operator">{</span> <span class="string">'data'</span>  <span class="operator">=&gt;</span> <span class="string">'info'</span>  <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<p>The initialization methods for both classes in the above will get <span style="white-space: nowrap;"><code><code>&#39;foo&#39; =&gt; &#39;bar&#39;</code></code></span>, <code><code>My::Class</code></code> will also get <span style="white-space: nowrap;"><code><code>&#39;param&#39; =&gt; &#39;value&#39;</code></code></span>, and <code><code>Parent::Class</code></code> will also get <span style="white-space: nowrap;"><code><code>&#39;data&#39; =&gt; &#39;info&#39;</code></code></span>. In this scheme, class-specific parameters will override general parameters specified at a higher level:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span>
     <span class="string">'default'</span> <span class="operator">=&gt;</span> <span class="string">'bar'</span><span class="operator">,</span>
     <span class="string">'Parent::Class'</span>  <span class="operator">=&gt;</span> <span class="operator">{</span> <span class="string">'default'</span> <span class="operator">=&gt;</span> <span class="string">'baz'</span> <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<p><code><code>My::Class</code></code> will get <span style="white-space: nowrap;"><code><code>&#39;default&#39; =&gt; &#39;bar&#39;</code></code></span>, and <code><code>Parent::Class</code></code> will get <span style="white-space: nowrap;"><code><code>&#39;default&#39; =&gt; &#39;baz&#39;</code></code></span>.</p>

<p>Calling <code><code>-&gt;new()</code></code> on an object works, too, and operates the same as calling <code><code>-&gt;new()</code></code> for the class of the object (i.e., <code><code>$obj-&gt;new()</code></code> is the same as <code><code>ref($obj)-&gt;new()</code></code>).</p>

<p>How the parameters passed to the <code><code>-&gt;new()</code></code> method are used to initialize the object is discussed later under <a href="#OBJECT-INITIALIZATION">&quot;OBJECT INITIALIZATION&quot;</a>.</p>

<p>NOTE: You cannot create objects from Object::InsideOut itself:</p>

<pre><code><code> <span class="comment"># This is an error</span>
 <span class="comment"># my $obj = Object::InsideOut-&gt;new();</span>
</code></code></pre>

<p>In this way, Object::InsideOut is not an object class, but functions more like a pragma.</p>

<h2 id="Object-IDs">Object IDs</h2>

<p>As stated earlier, this module implements inside-out objects as anonymous, read-only scalar references that are blessed into a class with the scalar containing the ID for the object.</p>

<p>Within methods, the object is passed in as the first argument:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> my_method
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>The object&#39;s ID is then obtained by dereferencing the object: <code><code>$$self</code></code>. Normally, this is only needed when accessing the object&#39;s field data:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@my_field</span> <span class="operator">:</span><span class="variable">Field</span><span class="operator">;</span>
 
 <span class="keyword">sub</span><span class="variable"> my_method
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
     <span class="operator">...</span>
     <span class="keyword">my</span> <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$my_field</span><span class="operator">[</span><span class="variable">$$self</span><span class="operator">]</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>At all other times, and especially in application code, the object should be treated as an <i>opaque</i> entity.</p>

<h1 id="ATTRIBUTES">ATTRIBUTES</h1>

<p>Much of the power of Object::InsideOut comes from the use of <i>attributes</i>: <i>Tags</i> on variables and subroutines that the <a href="../../../lib/attributes.html">attributes</a> module sends to Object::InsideOut at compile time. Object::InsideOut then makes use of the information in these tags to handle such operations as object construction, automatic accessor generation, and so on.</p>

<p>(Note: The use of attributes is not the same thing as <a href="../../../lib/Filter/Simple.html">source filtering</a>.)</p>

<p>An attribute consists of an identifier preceded by a colon, and optionally followed by a set of parameters in parentheses. For example, the attributes on the following array declare it as an object field, and specify the generation of an accessor method for that field:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@level</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Accessor</span><span class="operator">(</span><span class="variable">level</span><span class="operator">);</span>
</code></code></pre>

<p>When multiple attributes are assigned to a single entity, they may all appear on the same line (as shown above), or on separate lines:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@level</span>
     <span class="operator">:</span><span class="variable">Field</span>
     <span class="operator">:</span><span class="variable">Accessor</span><span class="operator">(</span><span class="variable">level</span><span class="operator">);</span>
</code></code></pre>

<p>However, due to limitations in the Perl parser, the entirety of any one attribute must be on a single line:</p>

<pre><code><code> <span class="comment"># This doesn't work</span>
 <span class="comment"># my @level</span>
 <span class="comment">#     :Field</span>
 <span class="comment">#     :Accessor('Name'   =&gt; 'level',</span>
 <span class="comment">#               'Return' =&gt; 'Old');</span>
 
 <span class="comment"># Each attribute must be all on one line</span>
 <span class="keyword">my</span> <span class="variable">@level</span>
     <span class="operator">:</span><span class="variable">Field</span>
     <span class="operator">:</span><span class="variable">Accessor</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'level'</span><span class="operator">,</span> <span class="string">'Return'</span> <span class="operator">=&gt;</span> <span class="string">'Old'</span><span class="operator">);</span>
</code></code></pre>

<p>For Object::InsideOut&#39;s purposes, the case of an attribute&#39;s name does not matter:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span><span class="operator">;</span>
    <span class="comment"># or</span>
 <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">FIELD</span><span class="operator">;</span>
</code></code></pre>

<p>However, by convention (as denoted in the <a href="../../../lib/attributes.html">attributes</a> module), an attribute&#39;s name should not be all lowercase.</p>

<h1 id="FIELDS">FIELDS</h1>

<h2 id="Field-Declarations">Field Declarations</h2>

<p>Object data fields consist of arrays within a class&#39;s package into which data are stored using the object&#39;s ID as the array index. An array is declared as being an object field by following its declaration with the <code><code>:Field</code></code> attribute:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@info</span> <span class="operator">:</span><span class="variable">Field</span><span class="operator">;</span>
</code></code></pre>

<p>Object data fields may also be hashes:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">%data</span> <span class="operator">:</span><span class="variable">Field</span><span class="operator">;</span>
</code></code></pre>

<p>However, as array access is as much as 40% faster than hash access, you should stick to using arrays. See <a href="#HASH-ONLY-CLASSES">&quot;HASH ONLY CLASSES&quot;</a> for more information on when hashes may be required.</p>

<h2 id="Getting-Data">Getting Data</h2>

<p>In class code, data can be fetched directly from an object&#39;s field array (hash) using the object&#39;s ID:</p>

<pre><code><code> <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$field</span><span class="operator">[</span><span class="variable">$$self</span><span class="operator">]</span><span class="operator">;</span>
     <span class="comment"># or</span>
 <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$field</span><span class="operator">{</span><span class="variable">$$self</span><span class="operator">}</span><span class="operator">;</span>
</code></code></pre>

<h2 id="Setting-Data">Setting Data</h2>

<p>Analogous to the above, data can be put directly into an object&#39;s field array (hash) using the object&#39;s ID:</p>

<pre><code><code> <span class="variable">$field</span><span class="operator">[</span><span class="variable">$$self</span><span class="operator">]</span> <span class="operator">=</span> <span class="variable">$data</span><span class="operator">;</span>
     <span class="comment"># or</span>
 <span class="variable">$field</span><span class="operator">{</span><span class="variable">$$self</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$data</span><span class="operator">;</span>
</code></code></pre>

<p>However, in threaded applications that use data sharing (i.e., use <code><code>threads::shared</code></code>), the above will not work when the object is shared between threads and the data being stored is either an array, hash or scalar reference (this includes other objects). This is because the <code><code>$data</code></code> must first be converted into shared data before it can be put into the field.</p>

<p>Therefore, Object::InsideOut automatically exports a method called <code><code>-&gt;set()</code></code> to each class. This method should be used in class code to put data into object fields whenever there is the possibility that the class code may be used in an application that uses <a href="../../../lib/threads/shared.html">threads::shared</a> (i.e., to make your class code <b>thread-safe</b>). The <code><code>-&gt;set()</code></code> method handles all details of converting the data to a shared form, and storing it in the field.</p>

<p>The <code><code>-&gt;set()</code></code> method, requires two arguments: A reference to the object field array/hash, and the data (as a scalar) to be put in it:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@my_field</span> <span class="operator">:</span><span class="variable">Field</span><span class="operator">;</span>
 
 <span class="keyword">sub</span><span class="variable"> store_data
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$data</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
     <span class="operator">...</span>
     <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">set</span><span class="operator">(\</span><span class="variable">@my_field</span><span class="operator">,</span> <span class="variable">$data</span><span class="operator">);</span>
 <span class="operator">}</span>
</code></code></pre>

<p>To be clear, the <code><code>-&gt;set()</code></code> method is used inside class code; not application code. Use it inside any object methods that set data in object field arrays/hashes.</p>

<p>In the event of a method naming conflict, the <code><code>-&gt;set()</code></code> method can be called using its fully-qualified name:</p>

<pre><code><code> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">Object::InsideOut::set</span><span class="operator">(\</span><span class="variable">@field</span><span class="operator">,</span> <span class="variable">$data</span><span class="operator">);</span>
</code></code></pre>

<h1 id="OBJECT-INITIALIZATION">OBJECT INITIALIZATION</h1>

<p>As stated in <a href="#Object-Creation">&quot;Object Creation&quot;</a>, object fields are initially populated with data as part of the object creation process by passing <span style="white-space: nowrap;"><code><code>key =&gt; value</code></code></span> parameters to the <code><code>-&gt;new()</code></code> method. These parameters can be processed automatically into object fields, or can be passed to a class-specific object initialization subroutine.</p>

<h2 id="Field-Specific-Parameters">Field-Specific Parameters</h2>

<p>When an object creation parameter corresponds directly to an object field, you can specify for Object::InsideOut to automatically place the parameter into the field by adding the <code><code>:Arg</code></code> attribute to the field declaration:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@foo</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="variable">foo</span><span class="operator">);</span>
</code></code></pre>

<p>For the above, the following would result in <code><code>$val</code></code> being placed in <code><code>My::Class</code></code>&#39;s <code><code>@foo</code></code> field during object creation:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'foo'</span> <span class="operator">=&gt;</span> <span class="variable">$val</span><span class="operator">);</span>
</code></code></pre>

<h2 id="Object-Initialization-Subroutines">Object Initialization Subroutines</h2>

<p>Many times, object initialization parameters do not correspond directly to object fields, or they may require special handling. For these, parameter processing is accomplished through a combination of an <code><code>:InitArgs</code></code> labeled hash, and an <code><code>:Init</code></code> labeled subroutine.</p>

<p>The <code><code>:InitArgs</code></code> labeled hash specifies the parameters to be extracted from the argument list supplied to the <code><code>-&gt;new()</code></code> method. Those parameters (and only those parameters) which match the keys in the <code><code>:InitArgs</code></code> hash are then packaged together into a single hash ref. The newly created object and this parameter hash ref are then sent to the <code><code>:Init</code></code> subroutine for processing.</p>

<p>Here is an example of a class with an <i>automatically handled</i> field and an <i>:Init handled</i> field:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="comment"># Automatically handled field</span>
     <span class="keyword">my</span> <span class="variable">@my_data</span>  <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="variable">data</span><span class="operator">)</span>  <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="variable">MY_DATA</span><span class="operator">);</span>
 
     <span class="comment"># ':Init' handled field</span>
     <span class="keyword">my</span> <span class="variable">@my_field</span> <span class="operator">:</span><span class="variable">Field</span><span class="operator">;</span>
 
     <span class="keyword">my</span> <span class="variable">%init_args</span> <span class="operator">:</span><span class="variable">InitArgs</span> <span class="operator">=</span> <span class="operator">(</span>
         <span class="string">'MY_PARAM'</span> <span class="operator">=&gt;</span> <span class="string">''</span><span class="operator">,</span>
     <span class="operator">);</span>
 
     <span class="keyword">sub</span><span class="variable"> _init :Init
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">exists</span><span class="operator">(</span><span class="variable">$args</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'MY_PARAM'</span><span class="operator">}</span><span class="operator">))</span> <span class="operator">{</span>
             <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">set</span><span class="operator">(\</span><span class="variable">@my_field</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'MY_PARAM'</span><span class="operator">}</span><span class="operator">);</span>
         <span class="operator">}</span>
     <span class="operator">}</span>
 
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>An object for this class would be created as follows:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'MY_DATA'</span>  <span class="operator">=&gt;</span> <span class="variable">$dat</span><span class="operator">,</span>
                          <span class="string">'MY_PARAM'</span> <span class="operator">=&gt;</span> <span class="variable">$parm</span><span class="operator">);</span>
</code></code></pre>

<p>This results in, first of all, <code><code>$dat</code></code> being placed in the object&#39;s <code><code>@my_data</code></code> field because the <code><code>MY_DATA</code></code> key is specified in the <code><code>:Arg</code></code> attribute for that field.</p>

<p>Then, <code><code>_init</code></code> is invoked with arguments consisting of the object (i.e., <code><code>$self</code></code>) and a hash ref consisting only of <span style="white-space: nowrap;"><code><code><span class="operator">{</span> <span class="string">'MY_PARAM'</span> <span class="operator">=&gt;</span> <span class="variable">$param</span> <span class="operator">}</span>
</code></code></span> because the key <code><code>MY_PARAM</code></code> is specified in the <code><code>:InitArgs</code></code> hash. <code><code>_init</code></code> checks that the parameter <code><code>MY_PARAM</code></code> exists in the hash ref, and then (since it does exist) adds <code><code>$parm</code></code> to the object&#39;s <code><code>@my_field</code></code> field.</p>

<dl>

<dt id="Setting-Data1">Setting Data</dt>
<dd>

<p>Data processed by the <code><code>:Init</code></code> subroutine may be placed directly into the class&#39;s field arrays (hashes) using the object&#39;s ID (i.e., <code><code>$$self</code></code>):</p>

<pre><code><code> <span class="variable">$my_field</span><span class="operator">[</span><span class="variable">$$self</span><span class="operator">]</span> <span class="operator">=</span> <span class="variable">$args</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'MY_PARAM'</span><span class="operator">}</span><span class="operator">;</span>
</code></code></pre>

<p>However, as shown in the example above, it is strongly recommended that you use the <a href="#Setting-Data">-&gt;set()</a> method:</p>

<pre><code><code> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">set</span><span class="operator">(\</span><span class="variable">@my_field</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'MY_PARAM'</span><span class="operator">}</span><span class="operator">);</span>
</code></code></pre>

<p>which handles converting the data to a shared format when needed for applications using <a href="../../../lib/threads/shared.html">threads::shared</a>.</p>

</dd>
<dt id="All-Parameters">All Parameters</dt>
<dd>

<p>The <code><code>:InitArgs</code></code> hash and the <code><code>:Arg</code></code> attribute on fields act as filters that constrain which initialization parameters are and are not sent to the <code><code>:Init</code></code> subroutine. If, however, a class does not have an <code><code>:InitArgs</code></code> hash <b>and</b> does not use the <code><code>:Arg</code></code> attribute on any of its fields, then its <code><code>:Init</code></code> subroutine (if it exists, of course) will get all the initialization parameters supplied to the <code><code>-&gt;new()</code></code> method.</p>

</dd>
</dl>

<h2 id="Mandatory-Parameters">Mandatory Parameters</h2>

<p>Field-specific parameters may be declared mandatory as follows:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span>
          <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span> <span class="string">'Mandatory'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
</code></code></pre>

<p>If a mandatory parameter is missing from the argument list to <code><code>-&gt;new()</code></code>, an error is generated.</p>

<p>For <code><code>:Init</code></code> handled parameters, use:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">%init_args</span> <span class="operator">:</span><span class="variable">InitArgs</span> <span class="operator">=</span> <span class="operator">(</span>
     <span class="string">'data'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
         <span class="string">'Mandatory'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<p><code><code>Mandatory</code></code> may be abbreviated to <code><code>Mand</code></code>, and <code><code>Required</code></code> or <code><code>Req</code></code> are synonymous.</p>

<h2 id="Default-Values">Default Values</h2>

<p>For optional parameters, defaults can be specified for field-specific parameters using either of these syntaxes:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span>
          <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span> <span class="string">'Default'</span> <span class="operator">=&gt;</span> <span class="string">'foo'</span><span class="operator">);</span>
 
 <span class="keyword">my</span> <span class="variable">@info</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="variable">info</span><span class="operator">)</span>  <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="string">'bar'</span><span class="operator">);</span>
</code></code></pre>

<p>If an optional parameter with a specified default is missing from the argument list to <code><code>-&gt;new()</code></code>, then the default is assigned to the field when the object is created (before the <code><code>:Init</code></code> subroutine, if any, is called).</p>

<p>The format for <code><code>:Init</code></code> handled parameters is:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">%init_args</span> <span class="operator">:</span><span class="variable">InitArgs</span> <span class="operator">=</span> <span class="operator">(</span>
     <span class="string">'data'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
         <span class="string">'Default'</span> <span class="operator">=&gt;</span> <span class="string">'foo'</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<p>In this case, if the parameter is missing from the argument list to <code><code>-&gt;new()</code></code>, then the parameter key is paired with the default value and added to the <code><code>:Init</code></code> argument hash ref (e.g., <span style="white-space: nowrap;"><code><code><span class="operator">{</span> <span class="string">'data'</span> <span class="operator">=&gt;</span> <span class="string">'foo'</span> <span class="operator">}</span>
</code></code></span>).</p>

<p>Fields can also be assigned a default value even if not associated with an initialization parameter:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@hash</span>  <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="operator">{}</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">@tuple</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="operator">[</span><span class="number">1</span><span class="operator">,</span> <span class="string">'bar'</span><span class="operator">]</span><span class="operator">);</span>
</code></code></pre>

<p>Note that when using <code><code>:Default</code></code>, the value must be properly structured Perl code (e.g., strings must be quoted as illustrated above).</p>

<p><code><code>Default</code></code> and <code><code>:Default</code></code> may be abbreviated to <code><code>Def</code></code> and <code><code>:Def</code></code> respectively.</p>

<h3 id="Generated-Default-Values">Generated Default Values</h3>

<p>It is also possible to <i>generate</i> default values on a per object basis by using code in the <code><code>:Default</code></code> directive.</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@IQ</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="number">50</span> <span class="operator">+</span> <span class="keyword">rand</span> <span class="number">100</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">@ID</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="keyword">our</span> <span class="variable">$next</span><span class="operator">;</span> <span class="operator">++</span><span class="variable">$next</span><span class="operator">);</span>
</code></code></pre>

<p>The above, for example, will initialize the <code><code>IQ</code></code> attribute of each new object to a different random number, while its <code><code>ID</code></code> attribute will be initialized with a sequential integer.</p>

<p>The code in a <code><code>:Default</code></code> specifier can also refer to the object being initialized, either as <code><code>$_[0]</code></code> or as <code><code>$self</code></code>. For example:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@unique_ID</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">gen_unique_ID</span><span class="operator">);</span>
</code></code></pre>

<p>Any code specified as a default will <i>not</i> have access to the surrounding lexical scope. For example, this will not work:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$MAX</span> <span class="operator">=</span> <span class="number">100</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$MIN</span> <span class="operator">=</span> <span class="number">0</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">@bar</span> <span class="operator">:</span><span class="variable">Field</span>
         <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="variable">$MIN</span> <span class="operator">+</span> <span class="keyword">rand</span><span class="operator">(</span><span class="variable">$MAX</span><span class="operator">-</span><span class="variable">$MIX</span><span class="operator">));</span>     <span class="comment"># Error</span>
</code></code></pre>

<p>For anything lexical or complex, you should factor the initializer out into a utility subroutine:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> _rand_max :Restricted
 </span><span class="operator">{</span>
     <span class="variable">$MIN</span> <span class="operator">+</span> <span class="keyword">rand</span><span class="operator">(</span><span class="variable">$MAX</span><span class="operator">-</span><span class="variable">$MIX</span><span class="operator">)</span>
 <span class="operator">}</span>
 
 <span class="keyword">my</span> <span class="variable">@bar</span> <span class="operator">:</span><span class="variable">Field</span>
         <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="variable">_rand_max</span><span class="operator">);</span>
</code></code></pre>

<p>When specifying a generated default using the <code><code>Default</code></code> tag inside an <code><code>:Arg</code></code> directive, you will need to wrap the code in a <code><code><span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="operator">}</span>
</code></code>, and <code><code>$_[0]</code></code> (but not <code><code>$self</code></code>) can be used to access the object being initialized:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@baz</span> <span class="operator">:</span><span class="variable">Field</span>
         <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="string">Name</span> <span class="operator">=&gt;</span> <span class="string">'baz'</span><span class="operator">,</span> <span class="string">Default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">-&gt;</span><span class="variable">biz</span> <span class="operator">});</span>
</code></code></pre>

<p>System functions need to similarly be wrapped in <code><code><span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="operator">}</span>
</code></code>:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@rand</span> <span class="operator">:</span><span class="variable">Field</span>
          <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">numeric</span><span class="operator">)</span>
          <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="string">Name</span> <span class="operator">=&gt;</span> <span class="string">'Rand'</span><span class="operator">,</span> <span class="string">Default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">rand</span> <span class="operator">});</span>
</code></code></pre>

<p>Subroutines can be accessed using a code reference:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span>
          <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="string">Name</span> <span class="operator">=&gt;</span> <span class="string">'Data'</span><span class="operator">,</span> <span class="string">Default</span> <span class="operator">=&gt;</span> <span class="operator">\&amp;</span><span class="variable">gen_default</span><span class="operator">);</span>
</code></code></pre>

<p>On the other hand, the above can also be simplified by using the <code><code>:Default</code></code> directive instead:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@baz</span>  <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="variable">baz</span><span class="operator">)</span>   <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">biz</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">@rand</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="variable">Rand</span><span class="operator">)</span>  <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="keyword">rand</span><span class="operator">)</span>  <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">numeric</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="variable">Data</span><span class="operator">)</span>  <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="variable">gen_default</span><span class="operator">);</span>
</code></code></pre>

<p>Using generated defaults in the <code><code>:InitArgs</code></code> hash requires the use of the same types of syntax as with the <code><code>Default</code></code> tag in an <code><code>:Arg</code></code> directive:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">%init_args</span> <span class="operator">:</span><span class="variable">InitArgs</span> <span class="operator">=</span> <span class="operator">(</span>
     <span class="string">'Baz'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
         <span class="string">'Default'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">-&gt;</span><span class="variable">biz</span> <span class="operator">},</span>
     <span class="operator">}</span><span class="operator">,</span>
     <span class="string">'Rand'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
         <span class="string">'Default'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">rand</span> <span class="operator">},</span>
     <span class="operator">}</span><span class="operator">,</span>
     <span class="string">'Data'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
         <span class="string">'Default'</span> <span class="operator">=&gt;</span> <span class="operator">\&amp;</span><span class="variable">gen_default</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<h3 id="Sequential-defaults">Sequential defaults</h3>

<p>In the previous section, one of the examples is not as safe or as convenient as it should be:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@ID</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="keyword">our</span> <span class="variable">$next</span><span class="operator">;</span> <span class="operator">++</span><span class="variable">$next</span><span class="operator">);</span>
</code></code></pre>

<p>The problem is the shared variable (<code><code>$next</code></code>) that&#39;s needed to track the allocation of <code><code>ID</code></code> values. Because it has to persist between calls, that variable has to be a package variable, except under Perl 5.10 or later where it could be a state variable instead:</p>

<pre><code><code> <span class="keyword">use</span> <span class="variable">feature</span> <span class="string">'state'</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">@ID</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span><span class="keyword">state</span> <span class="variable">$next</span><span class="operator">;</span> <span class="operator">++</span><span class="variable">$next</span><span class="operator">);</span>
</code></code></pre>

<p>The version with the package variable is unsafe, because anyone could then spoof ID numbers just by reassigning that universally accessible variable:</p>

<pre><code><code>    <span class="variable">$MyClass::next</span> <span class="operator">=</span> <span class="number">0</span><span class="operator">;</span>        <span class="comment"># Spoof the next object</span>
    <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">MyClass</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">;</span>    <span class="comment"># Object now has ID 1</span>
</code></code></pre>

<p>The state-variable version avoids this problem, but even that version is more complicated (and hence more error-prone) than it needs to be.</p>

<p>The <code><code>:SequenceFrom</code></code> directive (which can be abbreviated to <code><code>:SeqFrom</code></code> or <code><code>:Seq</code></code>) makes it much easier to specify that an attribute&#39;s default value is taken from a linearly increasing sequence. For instance, the ID example above could be rewritten as:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@ID</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">SequenceFrom</span><span class="operator">(</span><span class="number">1</span><span class="operator">);</span>
</code></code></pre>

<p>This directive automatically creates a hidden variable, initializes it to the initial value specified, generates a sequence starting at that initial value, and then uses successive elements of that sequence each time a default value is needed for that attribute during object creation.</p>

<p>If the initial value is a scalar, then the default sequence is generated by by computing <code><code>$previous_value++</code></code>. If it is an object, it is generated by calling <code><code>$obj-&gt;next()</code></code> (or by calling <code><code>$obj++</code></code> if the object doesn&#39;t have a <code><code>next()</code></code> method).</p>

<p>This makes it simple to create a series of objects with attributes whose values default to simple numeric, alphabetic, or alphanumeric sequences, or to the sequence specified by an iterator object of some kind:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@ID</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">SeqFrom</span><span class="operator">(</span><span class="number">1</span><span class="operator">);</span>                 <span class="comment"># 1, 2, 3...</span>
 
 <span class="keyword">my</span> <span class="variable">@ID</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">SeqFrom</span><span class="operator">(</span><span class="string">'AAA'</span><span class="operator">);</span>             <span class="comment"># 'AAA', 'AAB', 'AAC'...</span>
 
 <span class="keyword">my</span> <span class="variable">@ID</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">SeqFrom</span><span class="operator">(</span><span class="string">'A01'</span><span class="operator">);</span>             <span class="comment"># 'A01', 'A02', 'A03'...</span>
 
 <span class="keyword">my</span> <span class="variable">@ID</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">SeqFrom</span><span class="operator">(</span><span class="variable">ID_Iterator</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">);</span>  <span class="comment"># -&gt;next, -&gt;next, -&gt;next...</span>
</code></code></pre>

<p>In every other respect a <code><code>:SequenceFrom</code></code> directive is just like a <code><code>:Default</code></code>. For example, it can be used in conjunction with the <code><code>:Arg</code></code> directive as follows:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@ID</span> <span class="operator">:</span><span class="variable">Field</span>  <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="variable">ID</span><span class="operator">)</span>  <span class="operator">:</span><span class="variable">SeqFrom</span><span class="operator">(</span><span class="number">1</span><span class="operator">);</span>
</code></code></pre>

<p>However, not as a tag inside the <code><code>:Arg</code></code> directive:</p>

<pre><code><code> my @ID :Field  :Arg(&#39;Name&#39; =&gt; &#39;ID&#39;, &#39;SeqFrom&#39; =&gt; 1)   # WRONG</code></code></pre>

<p>For the <code><code>:InitArgs</code></code> hash, you will need to <i>roll your own</i> sequential defaults if required:</p>

<pre><code><code> <span class="keyword">use</span> <span class="variable">feature</span> <span class="string">'state'</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">%init_args</span> <span class="operator">:</span><span class="variable">InitArgs</span> <span class="operator">=</span> <span class="operator">(</span>
     <span class="string">'Counter'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
         <span class="string">'Default'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">state</span> <span class="variable">$next</span><span class="operator">;</span> <span class="operator">++</span><span class="variable">$next</span> <span class="operator">}</span>
     <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<h2 id="Parameter-Name-Matching">Parameter Name Matching</h2>

<p>Rather than having to rely on exact matches to parameter keys in the <code><code>-&gt;new()</code></code> argument list, you can specify a regular expressions to be used to match them to field-specific parameters:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@param</span> <span class="operator">:</span><span class="variable">Field</span>
           <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'param'</span><span class="operator">,</span> <span class="string">'Regexp'</span> <span class="operator">=&gt;</span> <span class="string">qr/^PARA?M$/i</span><span class="operator">);</span>
</code></code></pre>

<p>In this case, the parameter&#39;s key could be any of the following: PARAM, PARM, Param, Parm, param, parm, and so on. And the following would result in <code><code>$data</code></code> being placed in <code><code>My::Class</code></code>&#39;s <code><code>@param</code></code> field during object creation:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'Parm'</span> <span class="operator">=&gt;</span> <span class="variable">$data</span><span class="operator">);</span>
</code></code></pre>

<p>For <code><code>:Init</code></code> handled parameters, you would similarly use:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">%init_args</span> <span class="operator">:</span><span class="variable">InitArgs</span> <span class="operator">=</span> <span class="operator">(</span>
     <span class="string">'Param'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
         <span class="string">'Regex'</span> <span class="operator">=&gt;</span> <span class="string">qr/^PARA?M$/i</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<p>In this case, the match results in <span style="white-space: nowrap;"><code><code><span class="operator">{</span> <span class="string">'Param'</span> <span class="operator">=&gt;</span> <span class="variable">$data</span> <span class="operator">}</span>
</code></code></span> being sent to the <code><code>:Init</code></code> subroutine as the argument hash. Note that the <code><code>:InitArgs</code></code> hash key is substituted for the original argument key. This eliminates the need for any parameter key pattern matching within the <code><code>:Init</code></code> subroutine.</p>

<p><code><code>Regexp</code></code> may be abbreviated to <code><code>Regex</code></code> or <code><code>Re</code></code>.</p>

<h2 id="Object-Pre-initialization">Object Pre-initialization</h2>

<p>Occasionally, a child class may need to send a parameter to a parent class as part of object initialization. This can be accomplished by supplying a <code><code>:PreInit</code></code> labeled subroutine in the child class. These subroutines, if found, are called in order from the bottom of the class hierarchy upward (i.e., child classes first).</p>

<p>The subroutine should expect two arguments: The newly created (uninitialized) object (i.e., <code><code>$self</code></code>), and a hash ref of all the parameters from the <code><code>-&gt;new()</code></code> method call, including any additional parameters added by other <code><code>:PreInit</code></code> subroutines.</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> pre_init :PreInit
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>The parameter hash ref will not be exactly as supplied to <code><code>-&gt;new()</code></code>, but will be <i>flattened</i> into a single hash ref. For example,</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span>
     <span class="string">'param_X'</span> <span class="operator">=&gt;</span> <span class="string">'value_X'</span><span class="operator">,</span>
     <span class="operator">{</span>
         <span class="string">'param_A'</span> <span class="operator">=&gt;</span> <span class="string">'value_A'</span><span class="operator">,</span>
         <span class="string">'param_B'</span> <span class="operator">=&gt;</span> <span class="string">'value_B'</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
     <span class="string">'My::Class'</span> <span class="operator">=&gt;</span> <span class="operator">{</span> <span class="string">'param'</span> <span class="operator">=&gt;</span> <span class="string">'value'</span> <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<p>would produce</p>

<pre><code><code> <span class="operator">{</span>
     <span class="string">'param_X'</span> <span class="operator">=&gt;</span> <span class="string">'value_X'</span><span class="operator">,</span>
     <span class="string">'param_A'</span> <span class="operator">=&gt;</span> <span class="string">'value_A'</span><span class="operator">,</span>
     <span class="string">'param_B'</span> <span class="operator">=&gt;</span> <span class="string">'value_B'</span><span class="operator">,</span>
     <span class="string">'My::Class'</span> <span class="operator">=&gt;</span> <span class="operator">{</span> <span class="string">'param'</span> <span class="operator">=&gt;</span> <span class="string">'value'</span> <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>as the hash ref to the <code><code>:PreInit</code></code> subroutine.</p>

<p>The <code><code>:PreInit</code></code> subroutine may then add, modify or even remove any parameters from the hash ref as needed for its purposes. After all the <code><code>:PreInit</code></code> subroutines have been executed, object initialization will then proceed using the resulting parameter hash.</p>

<p>The <code><code>:PreInit</code></code> subroutine should not try to set data in its class&#39;s fields or in other class&#39;s fields (e.g., using <i>set</i> methods) as such changes will be overwritten during initialization phase which follows pre-initialization. The <code><code>:PreInit</code></code> subroutine is only intended for modifying initialization parameters prior to initialization.</p>

<h2 id="Initialization-Sequence">Initialization Sequence</h2>

<p>For the most part, object initialization can be conceptualized as proceeding from parent classes down through child classes. As such, calling child class methods from a parent class during object initialization may not work because the object will not have been fully initialized in the child classes.</p>

<p>Knowing the order of events during object initialization may help in determining when this can be done safely:</p>

<dl>

<dt id="The-scalar-reference-for-the-object-is-created-populated-with-an-Object-ID-and-blessed-into-the-appropriate-class.">1. The scalar reference for the object is created, populated with an <a href="#Object-ID">&quot;Object ID&quot;</a>, and blessed into the appropriate class.</dt>
<dd>

</dd>
<dt id="PreInit-subroutines-are-called-in-order-from-the-bottom-of-the-class-hierarchy-upward-i.e.-child-classes-first-.">2. <a href="#Object-Pre-initialization">:PreInit</a> subroutines are called in order from the bottom of the class hierarchy upward (i.e., child classes first).</dt>
<dd>

</dd>
<dt id="From-the-top-of-the-class-hierarchy-downward-i.e.-parent-classes-first-Default-Values-are-assigned-to-fields.-These-may-be-overwritten-by-subsequent-steps-below.-">3. From the top of the class hierarchy downward (i.e., parent classes first), <a href="#Default-Values">&quot;Default Values&quot;</a> are assigned to fields. (These may be overwritten by subsequent steps below.)</dt>
<dd>

</dd>
<dt id="From-the-top-of-the-class-hierarchy-downward-parameters-to-the--new-method-are-processed-for-:Arg-field-attributes-and-entries-in-the-:InitArgs-hash:">4. From the top of the class hierarchy downward, parameters to the <code><code>-&gt;new()</code></code> method are processed for <code><code>:Arg</code></code> field attributes and entries in the <code><code>:InitArgs</code></code> hash:</dt>
<dd>

<dl>

<dt id="a.-Parameter-Preprocessing-is-performed.">a. <a href="#Parameter-Preprocessing">&quot;Parameter Preprocessing&quot;</a> is performed.</dt>
<dd>

</dd>
<dt id="b.-Checks-for-Mandatory-Parameters-are-made.">b. Checks for <a href="#Mandatory-Parameters">&quot;Mandatory Parameters&quot;</a> are made.</dt>
<dd>

</dd>
<dt id="c.-Default-Values-specified-in-the-:InitArgs-hash-are-added-for-subsequent-processing-by-the-:Init-subroutine.">c. <a href="#Default-Values">&quot;Default Values&quot;</a> specified in the <code><code>:InitArgs</code></code> hash are added for subsequent processing by the <code><code>:Init</code></code> subroutine.</dt>
<dd>

</dd>
<dt id="d.-Type-checking-is-performed.">d. <a href="#TYPE-CHECKING">Type checking</a> is performed.</dt>
<dd>

</dd>
<dt id="e.-Field-Specific-Parameters-are-assigned-to-fields.">e. <a href="#Field-Specific-Parameters">&quot;Field-Specific Parameters&quot;</a> are assigned to fields.</dt>
<dd>

</dd>
</dl>

</dd>
<dt id="From-the-top-of-the-class-hierarchy-downward-:Init-subroutines-are-called-with-parameters-specified-in-the-:InitArgs-hash.">5. From the top of the class hierarchy downward, <a href="#Object-Initialization-Subroutines">:Init</a> subroutines are called with parameters specified in the <code><code>:InitArgs</code></code> hash.</dt>
<dd>

</dd>
<dt id="Checks-are-made-for-any-parameters-to--new-that-were-not-handled-in-the-above.-See-next-section.-">6. Checks are made for any parameters to <code><code>-&gt;new()</code></code> that were not handled in the above. (See next section.)</dt>
<dd>

</dd>
</dl>

<h2 id="Unhandled-Parameters">Unhandled Parameters</h2>

<p>It is an error to include any parameters to the <code><code>-&gt;new()</code></code> method that are not handled by at least one class in the hierarchy. The primary purpose of this is to catch typos in parameter names:</p>

<pre><code><code>  <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">Person</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'nane'</span> <span class="operator">=&gt;</span> <span class="string">'John'</span><span class="operator">);</span>   <span class="comment"># Should be 'name'</span>
</code></code></pre>

<p>The only time that checks for unhandled parameters are not made is when at least one class in the hierarchy does not have an <code><code>:InitArgs</code></code> hash <b>and</b> does not use the <code><code>:Arg</code></code> attribute on any of its fields <b>and</b> uses an <a href="#Object-Initialization-Subroutines">:Init</a> subroutine for processing parameters. In such a case, it is not possible for Object::InsideOut to determine which if any of the parameters are not handled by the <code><code>:Init</code></code> subroutine.</p>

<p>If you add the following construct to the start of your application:</p>

<pre><code><code> <span class="keyword">BEGIN</span> <span class="operator">{</span>
     <span class="keyword">no</span> <span class="variable">warnings</span> <span class="string">'once'</span><span class="operator">;</span>
     <span class="variable">$OIO::Args::Unhandled::WARN_ONLY</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>
 <span class="operator">}</span>
</code></code></pre>

<p>then unhandled parameters will only generate warnings rather than causing exceptions to be thrown.</p>

<h2 id="Modifying">Modifying <code><code>:InitArgs</code></code></h2>

<p>For performance purposes, Object::InsideOut <i>normalizes</i> each class&#39;s <code><code>:InitArgs</code></code> hash by creating keys in the form of <code><code>&#39;_X&#39;</code></code> for the various options it handles (e.g., <code><code>&#39;_R&#39;</code></code> for <code><code>&#39;Regexp&#39;</code></code>).</p>

<p>If a class has the unusual requirement to modify its <code><code>:InitArgs</code></code> hash during runtime, then it must renormalize the hash after making such changes by invoking <code><code>Object::InsideOut::normalize()</code></code> on it so that Object::InsideOut will pick up the changes:</p>

<pre><code><code> <span class="variable">Object::InsideOut::normalize</span><span class="operator">(\</span><span class="variable">%init_args</span><span class="operator">);</span>
</code></code></pre>

<h1 id="ACCESSOR-GENERATION">ACCESSOR GENERATION</h1>

<p>Accessors are object methods used to get data out of and put data into an object. You can, of course, write your own accessor code, but this can get a bit tedious, especially if your class has lots of fields. Object::InsideOut provides the capability to automatically generate accessors for you.</p>

<h2 id="Basic-Accessors">Basic Accessors</h2>

<p>A <i>get</i> accessor is vary basic: It just returns the value of an object&#39;s field:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span><span class="operator">;</span>
 
 <span class="keyword">sub</span><span class="variable"> fetch_data
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
     <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$data</span><span class="operator">[</span><span class="variable">$$self</span><span class="operator">]</span><span class="operator">);</span>
 <span class="operator">}</span>
</code></code></pre>

<p>and you would use it as follows:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">fetch_data</span><span class="operator">();</span>
</code></code></pre>

<p>To have Object::InsideOut generate such a <i>get</i> accessor for you, add a <code><code>:Get</code></code> attribute to the field declaration, specifying the name for the accessor in parentheses:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">fetch_data</span><span class="operator">);</span>
</code></code></pre>

<p>Similarly, a <i>set</i> accessor puts data in an object&#39;s field. The <i>set</i> accessors generated by Object::InsideOut check that they are called with at least one argument. They are specified using the <code><code>:Set</code></code> attribute:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Set</span><span class="operator">(</span><span class="variable">store_data</span><span class="operator">);</span>
</code></code></pre>

<p>Some programmers use the convention of naming <i>get</i> and <i>set</i> accessors using <i>get_</i> and <i>set_</i> prefixes. Such <i>standard</i> accessors can be generated using the <code><code>:Standard</code></code> attribute (which may be abbreviated to <code><code>:Std</code></code>):</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Std</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
</code></code></pre>

<p>which is equivalent to:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">get_data</span><span class="operator">)</span> <span class="operator">:</span><span class="variable">Set</span><span class="operator">(</span><span class="variable">set_data</span><span class="operator">);</span>
</code></code></pre>

<p>Other programmers prefer to use a single <i>combination</i> accessors that performs both functions: When called with no arguments, it <i>gets</i>, and when called with an argument, it <i>sets</i>. Object::InsideOut will generate such accessors with the <code><code>:Accessor</code></code> attribute. (This can be abbreviated to <code><code>:Acc</code></code>, or you can use <code><code>:Get_Set</code></code> or <code><code>:Combined</code></code> or <code><code>:Combo</code></code> or even <code><code>Mutator</code></code>.) For example:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
</code></code></pre>

<p>The generated accessor would be used in this manner:</p>

<pre><code><code> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">(</span><span class="variable">$val</span><span class="operator">);</span>           <span class="comment"># Puts data into the object's field</span>
 <span class="keyword">my</span> <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">();</span>    <span class="comment"># Fetches the object's field data</span>
</code></code></pre>

<h2 id="Set-Accessor-Return-Value"><i>Set</i> Accessor Return Value</h2>

<p>For any of the automatically generated methods that perform <i>set</i> operations, the default for the method&#39;s return value is the value being set (i.e., the <i>new</i> value).</p>

<p>You can specify the <i>set</i> accessor&#39;s return value using the <code><code>Return</code></code> attribute parameter (which may be abbreviated to <code><code>Ret</code></code>). For example, to explicitly specify the default behavior use:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Set</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'store_data'</span><span class="operator">,</span> <span class="string">'Return'</span> <span class="operator">=&gt;</span> <span class="string">'New'</span><span class="operator">);</span>
</code></code></pre>

<p>You can specify that the accessor should return the <i>old</i> (previous) value (or <code><code>undef</code></code> if unset):</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span> <span class="string">'Ret'</span> <span class="operator">=&gt;</span> <span class="string">'Old'</span><span class="operator">);</span>
</code></code></pre>

<p>You may use <code><code>Previous</code></code>, <code><code>Prev</code></code> or <code><code>Prior</code></code> as synonyms for <code><code>Old</code></code>.</p>

<p>Finally, you can specify that the accessor should return the object itself:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Std</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span> <span class="string">'Ret'</span> <span class="operator">=&gt;</span> <span class="string">'Object'</span><span class="operator">);</span>
</code></code></pre>

<p><code><code>Object</code></code> may be abbreviated to <code><code>Obj</code></code>, and is also synonymous with <code><code>Self</code></code>.</p>

<h2 id="Method-Chaining">Method Chaining</h2>

<p>An obvious case where method chaining can be used is when a field is used to store an object: A method for the stored object can be chained to the <i>get</i> accessor call that retrieves that object:</p>

<pre><code><code> $obj-&gt;get_stored_object()-&gt;stored_object_method()</code></code></pre>

<p>Chaining can be done off of <i>set</i> accessors based on their return value (see above). In this example with a <i>set</i> accessor that returns the <i>new</i> value:</p>

<pre><code><code> $obj-&gt;set_stored_object($stored_obj)-&gt;stored_object_method()</code></code></pre>

<p>the <i>set_stored_object()</i> call stores the new object, returning it as well, and then the <i>stored_object_method()</i> call is invoked via the stored/returned object. The same would work for <i>set</i> accessors that return the <i>old</i> value, too, but in that case the chained method is invoked via the previously stored (and now returned) object.</p>

<p>If the <a href="../../../lib/perl5/x86_64-linux-thread-multi/Want.html">Want</a> module (version 0.12 or later) is available, then Object::InsideOut also tries to do <i>the right thing</i> with method chaining for <i>set</i> accessors that don&#39;t store/return objects. In this case, the object used to invoke the <i>set</i> accessor will also be used to invoke the chained method (just as though the <i>set</i> accessor were declared with <span style="white-space: nowrap;"><code><code>&#39;Return&#39; =&gt; &#39;Object&#39;</code></code></span>):</p>

<pre><code><code> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">set_data</span><span class="operator">(</span><span class="string">'data'</span><span class="operator">)-&gt;</span><span class="variable">do_something</span><span class="operator">();</span>
</code></code></pre>

<p>To make use of this feature, just add <code><code><span class="keyword">use</span> <span class="variable">Want</span><span class="operator">;</span>
</code></code> to the beginning of your application.</p>

<p>Note, however, that this special handling does not apply to <i>get</i> accessors, nor to <i>combination</i> accessors invoked without an argument (i.e., when used as a <i>get</i> accessor). These must return objects in order for method chaining to succeed.</p>

<h2 id="lvalue-Accessors">:lvalue Accessors</h2>

<p>As documented in <a href="../../../lib/pod/perlsub.html#Lvalue-subroutines">&quot;Lvalue subroutines&quot; in perlsub</a>, an <code><code>:lvalue</code></code> subroutine returns a modifiable value. This modifiable value can then, for example, be used on the left-hand side (hence <code><code>LVALUE</code></code>) of an assignment statement, or a substitution regular expression.</p>

<p>For Perl 5.8.0 and later, Object::InsideOut supports the generation of <code><code>:lvalue</code></code> accessors such that their use in an <code><code>LVALUE</code></code> context will set the value of the object&#39;s field. Just add <code><code>&#39;lvalue&#39; =&gt; 1</code></code> to the <i>set</i> accessor&#39;s attribute. (<code><code>&#39;lvalue&#39;</code></code> may be abbreviated to <code><code>&#39;lv&#39;</code></code>.)</p>

<p>Additionally, <code><code>:Lvalue</code></code> (or its abbreviation <code><code>:lv</code></code>) may be used for a combined <i>get/set</i> <i>:lvalue</i> accessor. In other words, the following are equivalent:</p>

<pre><code><code> :Acc(&#39;Name&#39; =&gt; &#39;email&#39;, &#39;lvalue&#39; =&gt; 1)

 :Lvalue(email)</code></code></pre>

<p>Here is a detailed example:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Contact</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="comment"># Create separate a get accessor and an :lvalue set accessor</span>
     <span class="keyword">my</span> <span class="variable">@name</span>  <span class="operator">:</span><span class="variable">Field</span>
               <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">name</span><span class="operator">)</span>
               <span class="operator">:</span><span class="variable">Set</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'set_name'</span><span class="operator">,</span> <span class="string">'lvalue'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
 
     <span class="comment"># Create a standard get_/set_ pair of accessors</span>
     <span class="comment">#   The set_ accessor will be an :lvalue accessor</span>
     <span class="keyword">my</span> <span class="variable">@phone</span> <span class="operator">:</span><span class="variable">Field</span>
               <span class="operator">:</span><span class="variable">Std</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'phone'</span><span class="operator">,</span> <span class="string">'lvalue'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
 
     <span class="comment"># Create a combined get/set :lvalue accessor</span>
     <span class="keyword">my</span> <span class="variable">@email</span> <span class="operator">:</span><span class="variable">Field</span>
               <span class="operator">:</span><span class="variable">Lvalue</span><span class="operator">(</span><span class="variable">email</span><span class="operator">);</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">Contact</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 
 <span class="comment"># Use :lvalue accessors in assignment statements</span>
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">set_name</span><span class="operator">()</span>  <span class="operator">=</span> <span class="string">'Jerry D. Hedden'</span><span class="operator">;</span>
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">set_phone</span><span class="operator">()</span> <span class="operator">=</span> <span class="string">'800-555-1212'</span><span class="operator">;</span>
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">email</span><span class="operator">()</span>     <span class="operator">=</span> <span class="string">'jdhedden AT cpan DOT org'</span><span class="operator">;</span>
 
 <span class="comment"># Use :lvalue accessor in substituion regexp</span>
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">email</span><span class="operator">()</span> <span class="operator">=~</span> <span class="regex">s/ AT (\w+) DOT /\@$1./</span><span class="operator">;</span>
 
 <span class="comment"># Use :lvalue accessor in a 'substr' call</span>
 <span class="keyword">substr</span><span class="operator">(</span><span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">set_phone</span><span class="operator">(),</span> <span class="number">0</span><span class="operator">,</span> <span class="number">3</span><span class="operator">)</span> <span class="operator">=</span> <span class="string">'888'</span><span class="operator">;</span>
 
 <span class="keyword">print</span><span class="operator">(</span><span class="string">"Contact info:\n"</span><span class="operator">);</span>
 <span class="keyword">print</span><span class="operator">(</span><span class="string">"\tName:  "</span><span class="operator">,</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">name</span><span class="operator">(),</span>      <span class="string">"\n"</span><span class="operator">);</span>
 <span class="keyword">print</span><span class="operator">(</span><span class="string">"\tPhone: "</span><span class="operator">,</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">get_phone</span><span class="operator">(),</span> <span class="string">"\n"</span><span class="operator">);</span>
 <span class="keyword">print</span><span class="operator">(</span><span class="string">"\tEmail: "</span><span class="operator">,</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">email</span><span class="operator">(),</span>     <span class="string">"\n"</span><span class="operator">);</span>
</code></code></pre>

<p>The use of <code><code>:lvalue</code></code> accessors requires the installation of the <a href="../../../lib/perl5/x86_64-linux-thread-multi/Want.html">Want</a> module (version 0.12 or later) from CPAN. See particularly the section <a href="../../../lib/perl5/x86_64-linux-thread-multi/Want.html#Lvalue-subroutines:">&quot;Lvalue subroutines:&quot; in Want</a> for more information.</p>

<p><code><code>:lvalue</code></code> accessors also work like regular <i>set</i> accessors in being able to accept arguments, return values, and so on:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@pri</span> <span class="operator">:</span><span class="variable">Field</span>
         <span class="operator">:</span><span class="variable">Lvalue</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'priority'</span><span class="operator">,</span> <span class="string">'Return'</span> <span class="operator">=&gt;</span> <span class="string">'Old'</span><span class="operator">);</span>
  <span class="operator">...</span>
 <span class="keyword">my</span> <span class="variable">$old_pri</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">priority</span><span class="operator">(</span><span class="number">10</span><span class="operator">);</span>
</code></code></pre>

<p><code><code>:lvalue</code></code> accessors can be used in <a href="#Method-Chaining">method chains</a>.</p>

<p><b>Caveats</b>: While still classified as <i>experimental</i>, Perl&#39;s support for <code><code>:lvalue</code></code> subroutines has been around since 5.6.0, and a good number of CPAN modules make use of them.</p>

<p>By definition, because <code><code>:lvalue</code></code> accessors return the <i>location</i> of a field, they break encapsulation. As a result, some OO advocates eschew the use of <code><code>:lvalue</code></code> accessors.</p>

<p><code><code>:lvalue</code></code> accessors are slower than corresponding <i>non-lvalue</i> accessors. This is due to the fact that more code is needed to handle all the diverse ways in which <code><code>:lvalue</code></code> accessors may be used. (I&#39;ve done my best to optimize the generated code.) For example, here&#39;s the code that is generated for a simple combined accessor:</p>

<pre><code><code> <span class="variable">*Foo::foo</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
     <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$$field</span><span class="operator">[</span><span class="variable">$</span><span class="operator">{</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]}]</span><span class="operator">)</span> <span class="keyword">if</span> <span class="operator">(</span><span class="variable">@_</span> <span class="operator">==</span> <span class="number">1</span><span class="operator">);</span>
     <span class="variable">$$field</span><span class="operator">[</span><span class="variable">$</span><span class="operator">{</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]}]</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="operator">;</span>
 <span class="operator">};</span>
</code></code></pre>

<p>And the corresponding code for an <code><code>:lvalue</code></code> combined accessor:</p>

<pre><code><code> <span class="variable">*Foo::foo</span> <span class="operator">=</span> <span class="variable">sub</span> <span class="operator">:</span><span class="variable">lvalue</span> <span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$rv</span> <span class="operator">=</span> <span class="operator">!</span><span class="variable">Want::want_lvalue</span><span class="operator">(</span><span class="number">0</span><span class="operator">);</span>
     <span class="variable">Want::rreturn</span><span class="operator">(</span><span class="variable">$$field</span><span class="operator">[</span><span class="variable">$</span><span class="operator">{</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]}]</span><span class="operator">)</span> <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$rv</span> <span class="operator">&amp;&amp;</span> <span class="operator">(</span><span class="variable">@_</span> <span class="operator">==</span> <span class="number">1</span><span class="operator">));</span>
     <span class="keyword">my</span> <span class="variable">$assign</span><span class="operator">;</span>
     <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">my</span> <span class="variable">@args</span> <span class="operator">=</span> <span class="variable">Want::wantassign</span><span class="operator">(</span><span class="number">1</span><span class="operator">))</span> <span class="operator">{</span>
         <span class="variable">@_</span> <span class="operator">=</span> <span class="operator">(</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">,</span> <span class="variable">@args</span><span class="operator">);</span>
         <span class="variable">$assign</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>
     <span class="operator">}</span>
     <span class="keyword">if</span> <span class="operator">(</span><span class="variable">@_</span> <span class="operator">&gt;</span> <span class="number">1</span><span class="operator">)</span> <span class="operator">{</span>
         <span class="variable">$$field</span><span class="operator">[</span><span class="variable">$</span><span class="operator">{</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]}]</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="operator">;</span>
         <span class="variable">Want::lnoreturn</span> <span class="keyword">if</span> <span class="variable">$assign</span><span class="operator">;</span>
         <span class="variable">Want::rreturn</span><span class="operator">(</span><span class="variable">$$field</span><span class="operator">[</span><span class="variable">$</span><span class="operator">{</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]}]</span><span class="operator">)</span> <span class="keyword">if</span> <span class="variable">$rv</span><span class="operator">;</span>
     <span class="operator">}</span>
     <span class="operator">((</span><span class="variable">@_</span> <span class="operator">&gt;</span> <span class="number">1</span><span class="operator">)</span> <span class="operator">&amp;&amp;</span> <span class="operator">(</span><span class="variable">Want::wantref</span><span class="operator">()</span> <span class="keyword">eq</span> <span class="string">'OBJECT'</span><span class="operator">)</span> <span class="operator">&amp;&amp;</span>
      <span class="operator">!</span><span class="variable">Scalar::Util::blessed</span><span class="operator">(</span><span class="variable">$$field</span><span class="operator">[</span><span class="variable">$</span><span class="operator">{</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]}]</span><span class="operator">))</span>
            <span class="operator">?</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span> <span class="operator">:</span> <span class="variable">$$field</span><span class="operator">[</span><span class="variable">$</span><span class="operator">{</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]}]</span><span class="operator">;</span>
 <span class="operator">};</span>
</code></code></pre>

<h1 id="ALL-IN-ONE">ALL-IN-ONE</h1>

<p>Parameter naming and accessor generation may be combined:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">All</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
</code></code></pre>

<p>This is <i>syntactic shorthand</i> for:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="variable">data</span><span class="operator">)</span> <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
</code></code></pre>

<p>If you want the accessor to be <code><code>:lvalue</code></code>, use:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">LV_All</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
</code></code></pre>

<p>If <i>standard</i> accessors are desired, use:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Std_All</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
</code></code></pre>

<p>Attribute parameters affecting the <i>set</i> accessor may also be used. For example, if you want <i>standard</i> accessors with an <code><code>:lvalue</code></code> <i>set</i> accessor:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Std_All</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span> <span class="string">'Lvalue'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
</code></code></pre>

<p>If you want a combined accessor that returns the <i>old</i> value on <i>set</i> operations:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">All</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span> <span class="string">'Ret'</span> <span class="operator">=&gt;</span> <span class="string">'Old'</span><span class="operator">);</span>
</code></code></pre>

<p>And so on.</p>

<p>If you need to add attribute parameters that affect the <code><code>:Arg</code></code> portion (e.g., <code><code>Default</code></code>, <code><code>Mandatory</code></code>, etc.), then you cannot use <code><code>:All</code></code>. Fall back to using the separate attributes. For example:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span> <span class="string">'Mand'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">)</span>
                 <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span> <span class="string">'Ret'</span> <span class="operator">=&gt;</span> <span class="string">'Old'</span><span class="operator">);</span>
</code></code></pre>

<h1 id="READONLY-FIELDS">READONLY FIELDS</h1>

<p>If you want to declare a <i>read-only</i> field (i.e., one that can be initialized and retrieved, but which doesn&#39;t have a <i>set</i> accessor):</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="variable">data</span><span class="operator">)</span> <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
</code></code></pre>

<p>there is a <i>syntactic shorthand</i> for that, too:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">ReadOnly</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
</code></code></pre>

<p>or just:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">RO</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
</code></code></pre>

<p>If a <i>standard</i> <i>get</i> accessor is desired, use:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Std_RO</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
</code></code></pre>

<p>For obvious reasons, attribute parameters affecting the <i>set</i> accessor cannot be used with read-only fields, nor can <code><code>:ReadOnly</code></code> be combined with <code><code>:LValue</code></code>.</p>

<p>As with <code><code>:All</code></code>, if you need to add attribute parameters that affect the <code><code>:Arg</code></code> portion then you cannot use the <code><code>:RO</code></code> shorthand: Fall back to using the separate attributes in such cases. For example:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span> <span class="string">'Mand'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">)</span>
                 <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">);</span>
</code></code></pre>

<h1 id="DELEGATORS">DELEGATORS</h1>

<p>In addition to autogenerating accessors for a given field, you can also autogenerate <i>delegators</i> to that field. A delegator is an accessor that forwards its call to one of the object&#39;s fields.</p>

<p>For example, if your <i>Car</i> object has an <code><code>@engine</code></code> field, then you might need to send all acceleration requests to the <i>Engine</i> object stored in that field. Likewise, all braking requests may need to be forwarded to <i>Car</i>&#39;s field that stores the <i>Brakes</i> object:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Car</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">my</span> <span class="variable">@engine</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">engine</span><span class="operator">);</span>
     <span class="keyword">my</span> <span class="variable">@brakes</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">brakes</span><span class="operator">);</span>
 
     <span class="keyword">sub</span><span class="variable"> _init :Init</span><span class="operator">(</span>private<span class="operator">)</span>  <span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">engine</span><span class="operator">(</span><span class="variable">Engine</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">());</span>
         <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">brakes</span><span class="operator">(</span><span class="variable">Brakes</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">());</span>
     <span class="operator">}</span>
 
     <span class="keyword">sub</span><span class="variable"> accelerate </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
         <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">engine</span><span class="operator">-&gt;</span><span class="variable">accelerate</span><span class="operator">();</span>
     <span class="operator">}</span>
 
     <span class="keyword">sub</span><span class="variable"> decelerate </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
         <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">engine</span><span class="operator">-&gt;</span><span class="variable">decelerate</span><span class="operator">();</span>
     <span class="operator">}</span>
 
     <span class="keyword">sub</span><span class="variable"> brake </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$foot_pressure</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
         <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">brakes</span><span class="operator">-&gt;</span><span class="variable">brake</span><span class="operator">(</span><span class="variable">$foot_pressure</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>If the <i>Car</i> needs to forward other method calls to its <i>Engine</i> or <i>Brakes</i>, this quickly becomes tedious, repetitive, and error-prone. So, instead, you can just tell Object::InsideOut that a particular method should be automatically forwarded to a particular field, by specifying a <code><code>:Handles</code></code> attribute:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Car</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">my</span> <span class="variable">@engine</span> <span class="operator">:</span><span class="variable">Field</span>
                <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">engine</span><span class="operator">)</span>
                <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span><span class="variable">accelerate</span><span class="operator">,</span> <span class="variable">decelerate</span><span class="operator">);</span>
     <span class="keyword">my</span> <span class="variable">@brakes</span> <span class="operator">:</span><span class="variable">Field</span>
                <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">brakes</span><span class="operator">)</span>
                <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span><span class="variable">brake</span><span class="operator">);</span>
 
     <span class="keyword">sub</span><span class="variable"> _init :Init</span><span class="operator">(</span>private<span class="operator">)</span>  <span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">engine</span><span class="operator">(</span><span class="variable">Engine</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">());</span>
         <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">brakes</span><span class="operator">(</span><span class="variable">Brakes</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">());</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>This option generates and installs a single delegator method for each of its arguments, so the second example has exactly the same effect as the first example. The delegator simply calls the corresponding method on the object stored in the field, passing it the same argument list it received.</p>

<p>Sometimes, however, you may need to delegate a particular method to a field, but under a different name. For example, if the <i>Brake</i> class provides an <code><code>engage()</code></code> method, rather than a <code><code>brake()</code></code> method, then you&#39;d need <code><code>Car::brake()</code></code> to be implemented as:</p>

<pre><code><code>     <span class="keyword">sub</span><span class="variable"> brake </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$foot_pressure</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
         <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">brakes</span><span class="operator">-&gt;</span><span class="variable">engage</span><span class="operator">(</span><span class="variable">$foot_pressure</span><span class="operator">);</span>
     <span class="operator">}</span>
</code></code></pre>

<p>You can achieve that using the <code><code>:Handles</code></code> attribute, like so:</p>

<pre><code><code>     <span class="keyword">my</span> <span class="variable">@brakes</span> <span class="operator">:</span><span class="variable">Field</span>
                <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">brakes</span><span class="operator">)</span>
                <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span><span class="variable">brake</span><span class="operator">--&gt;</span><span class="variable">engage</span><span class="operator">);</span>
</code></code></pre>

<p>The long arrow version still creates a delegator method <code><code>brake()</code></code>, but makes that method delegate to your <i>Brakes</i> object by calling its <code><code>engage()</code></code> method instead.</p>

<p>If you are delegating a large number of methods to a particular field, the <code><code>:Handles</code></code> declarations soon become tedious:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@onboard_computer</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">comp</span><span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">Computer::Onboard</span><span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span><span class="variable">engine_monitor</span> <span class="variable">engine_diagnostics</span><span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span><span class="variable">engine_control</span> <span class="variable">airbag_deploy</span><span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span><span class="variable">GPS_control</span> <span class="variable">GPS_diagnostics</span> <span class="variable">GPS_reset</span><span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span><span class="variable">climate_control</span> <span class="variable">reversing_camera</span><span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span><span class="variable">cruise_control</span> <span class="variable">auto_park</span><span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span><span class="variable">iPod_control</span> <span class="variable">cell_phone_connect</span><span class="operator">);</span>
</code></code></pre>

<p>And, of course, every time the interface of the <code><code>Computer::Onboard</code></code> class changes, you have to change those <code><code>:Handles</code></code> declarations, too.</p>

<p>Sometimes, all you really want to say is: &quot;This field should handle anything it <i>can</i> handle&quot;. To do that, you write:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@onboard_computer</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">comp</span><span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">Computer::Onboard</span><span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span><span class="variable">Computer::Onboard</span><span class="operator">);</span>
</code></code></pre>

<p>That is, if a <code><code>:Handles</code></code> directive is given a name that includes a <code><code>::</code></code>, it treats that name as a class name, rather than a method name. Then it checks that class&#39;s metadata (see <a>INTROSPECTION</a>), retrieves a list of all the method names from the class, and uses that as the list of method names to delegate.</p>

<p>Unlike an explicit <code><code>:Handles( method_name )</code></code>, a <code><code>:Handles( Class::Name )</code></code> is tolerant of name collisions. If any method of <code><code>Class::Name</code></code> has the same name as another method or delegator that has already been installed in the current class, then <code><code>:Handles</code></code> just silently ignores that particular method, and doesn&#39;t try to replace the existing one. In other words, a <code><code>:Handles(Class::Name)</code></code> won&#39;t install a delegator to a method in <code><code>Class::Name</code></code> if that method is already being handled somewhere else by the current class.</p>

<p>For classes that don&#39;t have a <code><code>::</code></code> in their name (e.g., <code><code>DateTime</code></code> and <code><code>POE</code></code>), just append a <code><code>::</code></code> to the class name:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@init_time</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">init_time</span><span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span>    <span class="variable">DateTime</span>        <span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Default</span><span class="operator">(</span> <span class="variable">DateTime</span><span class="operator">-&gt;</span><span class="variable">now</span><span class="operator">()</span> <span class="operator">)</span>
                      <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span> <span class="variable">DateTime:</span>:      <span class="operator">);</span>
</code></code></pre>

<p>Note that, when using the class-based version of <code><code>:Handles</code></code>, every method is delegated with its name unchanged. If some of the object&#39;s methods should be delegated under different names, you have to specify that explicitly (and beforehand):</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@onboard_computer</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">comp</span><span class="operator">)</span> <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">Computer::Onboard</span><span class="operator">)</span>
                <span class="comment"># rename this method when delegating...</span>
                      <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span> <span class="variable">iPod_control</span><span class="operator">--&gt;</span><span class="variable">get_iPod</span> <span class="operator">)</span>
                <span class="comment"># delegate everything else with names unchanged...</span>
                      <span class="operator">:</span><span class="variable">Handles</span><span class="operator">(</span> <span class="variable">Computer::Onboard</span> <span class="operator">);</span>
</code></code></pre>

<p><code><code>Handles</code></code> may be abbreviated to <code><code>Handle</code></code> or <code><code>Hand</code></code>.</p>

<p>NOTES: Failure to add the appropriate object to the delegation field will lead to errors such as: <b>Can&#39;t call method &quot;bar&quot; on an undefined value</b>.</p>

<p>Typos in <code><code>:Handles</code></code> attribute declarations will lead to errors such as: <b>Can&#39;t locate object method &quot;bat&quot; via package &quot;Foo&quot;</b>. Adding an object of the wrong class to the delegation field will lead to the same error, but can be avoided by adding a <code><code>:Type</code></code> attribute for the appropriate class.</p>

<h1 id="PERMISSIONS">PERMISSIONS</h1>

<h2 id="Restricted-and-Private-Accessors">Restricted and Private Accessors</h2>

<p>By default, <a href="#ACCESSOR-GENERATION">automatically generated accessors</a>, can be called at any time. In other words, their access permission is <i>public</i>.</p>

<p>If desired, accessors can be made <i>restricted</i> - in which case they can only be called from within the class and any child classes in the hierarchy that are derived from it - or <i>private</i> - such that they can only be called from within the accessors&#39; class. Here are examples of the syntax for adding permissions:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span>     <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Std</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span>     <span class="string">'Permission'</span> <span class="operator">=&gt;</span> <span class="string">'private'</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">@info</span>     <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Set</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'set_info'</span><span class="operator">,</span> <span class="string">'Perm'</span> <span class="operator">=&gt;</span> <span class="string">'restricted'</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">@internal</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'internal'</span><span class="operator">,</span> <span class="string">'Private'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">@state</span>    <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'state'</span><span class="operator">,</span>    <span class="string">'Restricted'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
</code></code></pre>

<p>When creating a <i>standard</i> pair of <i>get_/set_</i> accessors, the permission setting is applied to both accessors. If different permissions are required on the two accessors, then you&#39;ll have to use separate <code><code>:Get</code></code> and <code><code>:Set</code></code> attributes on the field.</p>

<pre><code><code> <span class="comment"># Create a private set method</span>
 <span class="comment">#  and a restricted get method on the 'foo' field</span>
 <span class="keyword">my</span> <span class="variable">@foo</span> <span class="operator">:</span><span class="variable">Field</span>
         <span class="operator">:</span><span class="variable">Set</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'set_foo'</span><span class="operator">,</span> <span class="string">'Priv'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">)</span>
         <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'get_foo'</span><span class="operator">,</span> <span class="string">'Rest'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
 
 <span class="comment"># Create a restricted set method</span>
 <span class="comment">#  and a public get method on the 'bar' field</span>
 <span class="keyword">my</span> <span class="variable">%bar</span> <span class="operator">:</span><span class="variable">Field</span>
         <span class="operator">:</span><span class="variable">Set</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'set_bar'</span><span class="operator">,</span> <span class="string">'Perm'</span> <span class="operator">=&gt;</span> <span class="string">'restrict'</span><span class="operator">)</span>
         <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">get_bar</span><span class="operator">);</span>
</code></code></pre>

<p><code><code>Permission</code></code> may be abbreviated to <code><code>Perm</code></code>; <code><code>Private</code></code> may be abbreviated to <code><code>Priv</code></code>; and <code><code>Restricted</code></code> may be abbreviated to <code><code>Restrict</code></code>.</p>

<h2 id="Restricted-and-Private-Methods">Restricted and Private Methods</h2>

<p>In the same vein as describe above, access to methods can be narrowed by use of <code><code>:Restricted</code></code> and <code><code>:Private</code></code> attributes.</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> foo :Restricted
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Without either of these attributes, most methods have <i>public</i> access. If desired, you may explicitly label them with the <code><code>:Public</code></code> attribute.</p>

<h2 id="Exemptions">Exemptions</h2>

<p>It is also possible to specify classes that are exempt from the <i>Restricted</i> and <i>Private</i> access permissions (i.e., the method may be called from those classes as well):</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">%foo</span> <span class="operator">:</span><span class="variable">Field</span>
         <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'foo'</span><span class="operator">,</span> <span class="string">'Perm'</span> <span class="operator">=&gt;</span> <span class="string">'Restrict(Exempt::Class)'</span><span class="operator">)</span>
         <span class="operator">:</span><span class="variable">Get</span><span class="operator">(</span><span class="variable">get_bar</span><span class="operator">);</span>
 
 <span class="keyword">sub</span><span class="variable"> bar :Private</span><span class="operator">(</span>Some::Class, Another::Class<span class="operator">)</span>
 <span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>An example of when this might be needed is with delegation mechanisms.</p>

<h2 id="Hidden-Methods">Hidden Methods</h2>

<p>For subroutines marked with the following attributes (most of which are discussed later in this document):</p>

<dl>

<dt id="ID">:ID</dt>
<dd>

</dd>
<dt id="PreInit">:PreInit</dt>
<dd>

</dd>
<dt id="Init">:Init</dt>
<dd>

</dd>
<dt id="Replicate">:Replicate</dt>
<dd>

</dd>
<dt id="Destroy">:Destroy</dt>
<dd>

</dd>
<dt id="Automethod">:Automethod</dt>
<dd>

</dd>
<dt id="Dumper">:Dumper</dt>
<dd>

</dd>
<dt id="Pumper">:Pumper</dt>
<dd>

</dd>
<dt id="MOD_-_ATTRS">:MOD_*_ATTRS</dt>
<dd>

</dd>
<dt id="FETCH_-_ATTRS">:FETCH_*_ATTRS</dt>
<dd>

</dd>
</dl>

<p>Object::InsideOut normally renders them uncallable (hidden) to class and application code (as they should normally only be needed by Object::InsideOut itself). If needed, this behavior can be overridden by adding the <code><code>Public</code></code>, <code><code>Restricted</code></code> or <code><code>Private</code></code> attribute parameters:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> _init :Init</span><span class="operator">(</span>private<span class="operator">)</span>    <span class="comment"># Callable from within this class</span>
 <span class="operator">{</span>
     <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<h2 id="Restricted-and-Private-Classes">Restricted and Private Classes</h2>

<p>Permission for object creation on a class can be narrowed by adding a <code><code>:Restricted</code></code> or <code><code>:Private</code></code> flag to its <span style="white-space: nowrap;"><code><code>use Object::InsideOut ...</code></code></span> declaration. This basically adds <code><code>:Restricted/:Private</code></code> permissions on the <code><code>-&gt;new()</code></code> method for that class. Exemptions are also supported.</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Foo</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">Bar</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">'Foo'</span><span class="operator">,</span> <span class="string">':Restricted(Ping, Pong)'</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>In the above, class <code><code>Bar</code></code> inherits from class <code><code>Foo</code></code>, and its constructor is restricted to itself, classes that inherit from <code><code>Bar</code></code>, and the classes <code><code>Ping</code></code> and <code><code>Pong</code></code>.</p>

<p>As constructors are inherited, any class that inherits from <code><code>Bar</code></code> would also be a restricted class. To overcome this, any child class would need to add its own permission declaration:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Baz</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw/Bar :Private(My::Class)/</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Here, class <code><code>Baz</code></code> inherits from class <code><code>Bar</code></code>, and its constructor is restricted to itself (i.e., private) and class <code><code>My::Class</code></code>.</p>

<p>Inheriting from a <code><code>:Private</code></code> class is permitted, but objects cannot be created for that class unless it has a permission declaration of its own:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Zork</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw/:Public Baz/</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Here, class <code><code>Zork</code></code> inherits from class <code><code>Baz</code></code>, and its constructor has unrestricted access. (In general, don&#39;t use the <code><code>:Public</code></code> declaration for a class except to overcome constructor permissions inherited from parent classes.)</p>

<h1 id="TYPE-CHECKING">TYPE CHECKING</h1>

<p>Object::InsideOut can be directed to add type-checking code to the <i>set/combined</i> accessors it generates, and to perform type checking on object initialization parameters.</p>

<h2 id="Field-Type-Checking">Field Type Checking</h2>

<p>Type checking for a field can be specified by adding the <code><code>:Type</code></code> attribute to the field declaration:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@count</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">numeric</span><span class="operator">);</span>
 
 <span class="keyword">my</span> <span class="variable">@objs</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">list</span><span class="operator">(</span><span class="variable">My::Class</span><span class="operator">));</span>
</code></code></pre>

<p>The <code><code>:Type</code></code> attribute results in type checking code being added to <i>set/combined</i> accessors generated by Object::InsideOut, and will perform type checking on object initialization parameters processed by the <code><code>:Arg</code></code> attribute.</p>

<p>Available Types are:</p>

<dl>

<dt id="scalar">&#39;scalar&#39;</dt>
<dd>

<p>Permits anything that is not a reference.</p>

</dd>
<dt id="numeric">&#39;numeric&#39;</dt>
<dd>

<p>Can also be specified as <code><code>Num</code></code> or <code><code>Number</code></code>. This uses <a href="../../../lib/Scalar/Util.html#looks_like_number-EXPR">Scalar::Util::looks_like_number()</a> to test the input value.</p>

</dd>
<dt id="list-or-array">&#39;list&#39; or &#39;array&#39;</dt>
<dd>

</dd>
<dt id="list-_subtype_-or-array-_subtype_-">&#39;list(_subtype_)&#39; or &#39;array(_subtype_)&#39;</dt>
<dd>

<p>This type permits an accessor to accept multiple values (which are then placed in an array ref) or a single array ref.</p>

<p>For object initialization parameters, it permits a single value (which is then placed in an array ref) or an array ref.</p>

<p>When specified, the contents of the resulting array ref are checked against the specified subtype:</p>

<dl>

<dt id="scalar1">&#39;scalar&#39;</dt>
<dd>

<p>Same as for the basic type above.</p>

</dd>
<dt id="numeric1">&#39;numeric&#39;</dt>
<dd>

<p>Same as for the basic type above.</p>

</dd>
<dt id="A-class-name">A class name</dt>
<dd>

<p>Same as for the basic type below.</p>

</dd>
<dt id="A-reference-type">A reference type</dt>
<dd>

<p>Any reference type (in all caps) as returned by <a href="../../../lib/pod/perlfunc.html#ref-EXPR">ref()</a>).</p>

</dd>
</dl>

</dd>
<dt id="ARRAY_ref">&#39;ARRAY_ref&#39;</dt>
<dd>

</dd>
<dt id="ARRAY_ref-_subtype_-">&#39;ARRAY_ref(_subtype_)&#39;</dt>
<dd>

<p>This specifies that only a single array reference is permitted. Can also be specified as <code><code>ARRAYref</code></code>.</p>

<p>When specified, the contents of the array ref are checked against the specified subtype as per the above.</p>

</dd>
<dt id="HASH">&#39;HASH&#39;</dt>
<dd>

<p>This type permits an accessor to accept multiple <span style="white-space: nowrap;"><code><code>key =&gt; value</code></code></span> pairs (which are then placed in a hash ref) or a single hash ref.</p>

<p>For object initialization parameters, only a single ref is permitted.</p>

</dd>
<dt id="HASH_ref">&#39;HASH_ref&#39;</dt>
<dd>

<p>This specifies that only a single hash reference is permitted. Can also be specified as <code><code>HASHref</code></code>.</p>

</dd>
<dt id="SCALAR_ref">&#39;SCALAR_ref&#39;</dt>
<dd>

<p>This type permits an accessor to accept a single scalar reference. Can also be specified as <code><code>SCALARref</code></code>.</p>

</dd>
<dt id="A-class-name1">A class name</dt>
<dd>

<p>This permits only an object of the specified class, or one of its sub-classes (i.e., type checking is done using <code><code>-&gt;isa()</code></code>). For example, <code><code>My::Class</code></code>. The class name <code><code>UNIVERSAL</code></code> permits any object. The class name <code><code>Object::InsideOut</code></code> permits any object generated by an Object::InsideOut class.</p>

</dd>
<dt id="Other-reference-type">Other reference type</dt>
<dd>

<p>This permits only a reference of the specified type (as returned by <a href="../../../lib/pod/perlfunc.html#ref-EXPR">ref()</a>). The type must be specified in all caps. For example, <code><code>CODE</code></code>.</p>

</dd>
</dl>

<p>The <code><code>:Type</code></code> attribute can also be supplied with a code reference to provide custom type checking. The code ref may either be in the form of an anonymous subroutine, or a fully-qualified subroutine name. The result of executing the code ref on the input argument should be a boolean value. Here&#39;s some examples:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="comment"># Type checking using an anonymous subroutine</span>
     <span class="comment">#  (This checks that the argument is an object)</span>
     <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="variable">Scalar::Util::blessed</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">)</span> <span class="operator">})</span>
                     <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
 
     <span class="comment"># Type checking using a fully-qualified subroutine name</span>
     <span class="keyword">my</span> <span class="variable">@num</span>  <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Type</span><span class="operator">(\&amp;</span><span class="variable">My::Class::positive</span><span class="operator">)</span>
                     <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="variable">num</span><span class="operator">);</span>
 
     <span class="comment"># The type checking subroutine may be made 'Private'</span>
     <span class="keyword">sub</span><span class="variable"> positive :Private
     </span><span class="operator">{</span>
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">Scalar::Util::looks_like_number</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">)</span> <span class="operator">&amp;&amp;</span>
                 <span class="operator">(</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span> <span class="operator">&gt;</span> <span class="number">0</span><span class="operator">));</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<h2 id="Type-Checking-on-Parameters">Type Checking on <code><code>:Init</code></code> Parameters</h2>

<p>For object initialization parameters that are sent to the <code><code>:Init</code></code> subroutine during object initialization, the parameter&#39;s type can be specified in the <code><code>:InitArgs</code></code> hash for that parameter using the same types as specified in the previous section. For example:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">%init_args</span> <span class="operator">:</span><span class="variable">InitArgs</span> <span class="operator">=</span> <span class="operator">(</span>
     <span class="string">'COUNT'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
         <span class="string">'Type'</span> <span class="operator">=&gt;</span> <span class="string">'numeric'</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
     <span class="string">'OBJS'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
         <span class="string">'Type'</span> <span class="operator">=&gt;</span> <span class="string">'list(My::Class)'</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<p>One exception involves custom type checking: If referenced in an <code><code>:InitArgs</code></code> hash, the type checking subroutine cannot be made <code><code>:Private</code></code>:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> check_type   </span><span class="comment"># Cannot be :Private</span><span class="variable">
     </span><span class="operator">{</span>
        <span class="operator">...</span>
     <span class="operator">}</span>
 
     <span class="keyword">my</span> <span class="variable">%init_args</span> <span class="operator">:</span><span class="variable">InitArgs</span> <span class="operator">=</span> <span class="operator">(</span>
         <span class="string">'ARG'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
             <span class="string">'Type'</span> <span class="operator">=&gt;</span> <span class="operator">\&amp;</span><span class="variable">check_type</span><span class="operator">,</span>
         <span class="operator">}</span><span class="operator">,</span>
     <span class="operator">);</span>
 
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Also, as shown, it also doesn&#39;t have to be a fully-qualified name.</p>

<h1 id="CUMULATIVE-METHODS">CUMULATIVE METHODS</h1>

<p>Normally, methods with the same name in a class hierarchy are masked (i.e., overridden) by inheritance - only the method in the most-derived class is called. With cumulative methods, this masking is removed, and the same-named method is called in each of the classes within the hierarchy. The return results from each call (if any) are then gathered together into the return value for the original method call. For example,</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> what_am_i :Cumulative
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
 
         <span class="keyword">my</span> <span class="variable">$ima</span> <span class="operator">=</span> <span class="operator">(</span><span class="keyword">ref</span><span class="operator">(</span><span class="variable">$self</span><span class="operator">)</span> <span class="keyword">eq</span> <span class="keyword">__PACKAGE__</span><span class="operator">)</span>
                     <span class="operator">?</span> <span class="string">q/I was created as a /</span>
                     <span class="operator">:</span> <span class="string">q/My top class is /</span><span class="operator">;</span>
 
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$ima</span> <span class="operator">.</span> <span class="keyword">__PACKAGE__</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">My::Foo</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">'My::Class'</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> what_am_i :Cumulative
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
 
         <span class="keyword">my</span> <span class="variable">$ima</span> <span class="operator">=</span> <span class="operator">(</span><span class="keyword">ref</span><span class="operator">(</span><span class="variable">$self</span><span class="operator">)</span> <span class="keyword">eq</span> <span class="keyword">__PACKAGE__</span><span class="operator">)</span>
                     <span class="operator">?</span> <span class="string">q/I was created as a /</span>
                     <span class="operator">:</span> <span class="string">q/I'm also a /</span><span class="operator">;</span>
 
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$ima</span> <span class="operator">.</span> <span class="keyword">__PACKAGE__</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">My::Child</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">'My::Foo'</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> what_am_i :Cumulative
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
 
         <span class="keyword">my</span> <span class="variable">$ima</span> <span class="operator">=</span> <span class="operator">(</span><span class="keyword">ref</span><span class="operator">(</span><span class="variable">$self</span><span class="operator">)</span> <span class="keyword">eq</span> <span class="keyword">__PACKAGE__</span><span class="operator">)</span>
                     <span class="operator">?</span> <span class="string">q/I was created as a /</span>
                     <span class="operator">:</span> <span class="string">q/I'm in class /</span><span class="operator">;</span>
 
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$ima</span> <span class="operator">.</span> <span class="keyword">__PACKAGE__</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Child</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 <span class="keyword">my</span> <span class="variable">@desc</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">what_am_i</span><span class="operator">();</span>
 <span class="keyword">print</span><span class="operator">(</span><span class="keyword">join</span><span class="operator">(</span><span class="string">"\n"</span><span class="operator">,</span> <span class="variable">@desc</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">);</span>
</code></code></pre>

<p>produces:</p>

<pre><code><code> My top class is My::Class
 I&#39;m also a My::Foo
 I was created as a My::Child</code></code></pre>

<p>When called in a list context (as in the above), the return results of cumulative methods are accumulated, and returned as a list.</p>

<p>In a scalar context, a results object is returned that segregates the results by class for each of the cumulative method calls. Through overloading, this object can then be dereferenced as an array, hash, string, number, or boolean. For example, the above could be rewritten as:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Child</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 <span class="keyword">my</span> <span class="variable">$desc</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">what_am_i</span><span class="operator">();</span>        <span class="comment"># Results object</span>
 <span class="keyword">print</span><span class="operator">(</span><span class="keyword">join</span><span class="operator">(</span><span class="string">"\n"</span><span class="operator">,</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$desc</span><span class="operator">}</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">);</span>   <span class="comment"># Dereference as an array</span>
</code></code></pre>

<p>The following uses hash dereferencing:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Child</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 <span class="keyword">my</span> <span class="variable">$desc</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">what_am_i</span><span class="operator">();</span>
 <span class="keyword">while</span> <span class="operator">(</span><span class="keyword">my</span> <span class="operator">(</span><span class="variable">$class</span><span class="operator">,</span> <span class="variable">$value</span><span class="operator">)</span> <span class="operator">=</span> <span class="keyword">each</span><span class="operator">(</span><span class="variable">%</span><span class="operator">{</span><span class="variable">$desc</span><span class="operator">}</span><span class="operator">))</span> <span class="operator">{</span>
     <span class="keyword">print</span><span class="operator">(</span><span class="string">"Class </span><span class="variable">$class</span><span class="string"> reports:\n\t</span><span class="variable">$value</span><span class="string">\n"</span><span class="operator">);</span>
 <span class="operator">}</span>
</code></code></pre>

<p>and produces:</p>

<pre><code><code> Class My::Class reports:
         My top class is My::Class
 Class My::Child reports:
         I was created as a My::Child
 Class My::Foo reports:
         I&#39;m also a My::Foo</code></code></pre>

<p>As illustrated above, cumulative methods are tagged with the <code><code>:Cumulative</code></code> attribute (or <span style="white-space: nowrap;"><code><code>:Cumulative(top down)</code></code></span>), and propagate from the <i>top down</i> through the class hierarchy (i.e., from the parent classes down through the child classes). If tagged with <span style="white-space: nowrap;"><code><code>:Cumulative(bottom up)</code></code></span>, they will propagated from the object&#39;s class upward through the parent classes.</p>

<h1 id="CHAINED-METHODS">CHAINED METHODS</h1>

<p>In addition to <code><code>:Cumulative</code></code>, Object::InsideOut provides a way of creating methods that are chained together so that their return values are passed as input arguments to other similarly named methods in the same class hierarchy. In this way, the chained methods act as though they were <i>piped</i> together.</p>

<p>For example, imagine you had a method called <code><code>format_name</code></code> that formats some text for display:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Subscriber</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> format_name </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$name</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="comment"># Strip leading and trailing whitespace</span>
         <span class="variable">$name</span> <span class="operator">=~</span> <span class="regex">s/^\s+//</span><span class="operator">;</span>
         <span class="variable">$name</span> <span class="operator">=~</span> <span class="regex">s/\s+$//</span><span class="operator">;</span>
 
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$name</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>And elsewhere you have a second class that formats the case of names:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Person</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Lingua::EN::NameCase</span> <span class="string">qw(nc)</span><span class="operator">;</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> format_name
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$name</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="comment"># Attempt to properly case names</span>
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">nc</span><span class="operator">(</span><span class="variable">$name</span><span class="operator">));</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>And you decide that you&#39;d like to perform some formatting of your own, and then have all the parent methods apply their own formatting. Normally, if you have a single parent class, you&#39;d just call the method directly with <code><code>$self-&gt;SUPER::format_name($name)</code></code>, but if you have more than one parent class you&#39;d have to explicitly call each method directly:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Customer</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(Person Subscriber)</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> format_name
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$name</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="comment"># Compress all whitespace into a single space</span>
         <span class="variable">$name</span> <span class="operator">=~</span> <span class="regex">s/\s+/ /g</span><span class="operator">;</span>
 
         <span class="variable">$name</span> <span class="operator">=</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">Subscriber::format_name</span><span class="operator">(</span><span class="variable">$name</span><span class="operator">);</span>
         <span class="variable">$name</span> <span class="operator">=</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">Person::format_name</span><span class="operator">(</span><span class="variable">$name</span><span class="operator">);</span>
 
         <span class="keyword">return</span> <span class="variable">$name</span><span class="operator">;</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>With Object::InsideOut, you&#39;d add the <code><code>:Chained</code></code> attribute to each class&#39;s <code><code>format_name</code></code> method, and the methods will be chained together automatically:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Subscriber</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> format_name :Chained
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$name</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="comment"># Strip leading and trailing whitespace</span>
         <span class="variable">$name</span> <span class="operator">=~</span> <span class="regex">s/^\s+//</span><span class="operator">;</span>
         <span class="variable">$name</span> <span class="operator">=~</span> <span class="regex">s/\s+$//</span><span class="operator">;</span>
 
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$name</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">Person</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Lingua::EN::NameCase</span> <span class="string">qw(nc)</span><span class="operator">;</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> format_name :Chained
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$name</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="comment"># Attempt to properly case names</span>
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">nc</span><span class="operator">(</span><span class="variable">$name</span><span class="operator">));</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">Customer</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(Person Subscriber)</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> format_name :Chained
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$name</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="comment"># Compress all whitespace into a single space</span>
         <span class="variable">$name</span> <span class="operator">=~</span> <span class="regex">s/\s+/ /g</span><span class="operator">;</span>
 
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$name</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>So passing in someone&#39;s name to <code><code>format_name</code></code> in <code><code>Customer</code></code> would cause leading and trailing whitespace to be removed, then the name to be properly cased, and finally whitespace to be compressed to a single space. The resulting <code><code>$name</code></code> would be returned to the caller:</p>

<pre><code><code> <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$name</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">format_name</span><span class="operator">(</span><span class="variable">$name_raw</span><span class="operator">);</span>
</code></code></pre>

<p>Unlike <code><code>:Cumulative</code></code> methods, <code><code>:Chained</code></code> methods <b>always</b> returns an array - even if there is only one value returned. Therefore, <code><code>:Chained</code></code> methods should always be called in an array context, as illustrated above.</p>

<p>The default direction is to chain methods from the parent classes at the top of the class hierarchy down through the child classes. You may use the attribute <span style="white-space: nowrap;"><code><code>:Chained(top down)</code></code></span> to make this more explicit.</p>

<p>If you label the method with the <span style="white-space: nowrap;"><code><code>:Chained(bottom up)</code></code></span> attribute, then the chained methods are called starting with the object&#39;s class and working upward through the parent classes in the class hierarchy, similar to how <span style="white-space: nowrap;"><code><code>:Cumulative(bottom up)</code></code></span> works.</p>

<h1 id="ARGUMENT-MERGING">ARGUMENT MERGING</h1>

<p>As mentioned under <a href="#Object-Creation">&quot;Object Creation&quot;</a>, the <code><code>-&gt;new()</code></code> method can take parameters that are passed in as combinations of <span style="white-space: nowrap;"><code><code>key =&gt; value</code></code></span> pairs and/or hash refs:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span>
     <span class="string">'param_X'</span> <span class="operator">=&gt;</span> <span class="string">'value_X'</span><span class="operator">,</span>
     <span class="string">'param_Y'</span> <span class="operator">=&gt;</span> <span class="string">'value_Y'</span><span class="operator">,</span>
     <span class="operator">{</span>
         <span class="string">'param_A'</span> <span class="operator">=&gt;</span> <span class="string">'value_A'</span><span class="operator">,</span>
         <span class="string">'param_B'</span> <span class="operator">=&gt;</span> <span class="string">'value_B'</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
     <span class="operator">{</span>
         <span class="string">'param_Q'</span> <span class="operator">=&gt;</span> <span class="string">'value_Q'</span><span class="operator">,</span>
     <span class="operator">}</span><span class="operator">,</span>
 <span class="operator">);</span>
</code></code></pre>

<p>The parameters are <i>merged</i> into a single hash ref before they are processed.</p>

<p>Adding the <code><code>:MergeArgs</code></code> attribute to your methods gives them a similar capability. Your method will then get two arguments: The object and a single hash ref of the <i>merged</i> arguments. For example:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Foo</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="operator">...</span>
 
     <span class="keyword">sub</span><span class="variable"> my_method :MergeArgs </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="keyword">my</span> <span class="variable">$param</span> <span class="operator">=</span> <span class="variable">$args</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'param'</span><span class="operator">}</span><span class="operator">;</span>
         <span class="keyword">my</span> <span class="variable">$data</span>  <span class="operator">=</span> <span class="variable">$args</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'data'</span><span class="operator">}</span><span class="operator">;</span>
         <span class="keyword">my</span> <span class="variable">$flag</span>  <span class="operator">=</span> <span class="variable">$args</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'flag'</span><span class="operator">}</span><span class="operator">;</span>
         <span class="operator">...</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">Foo</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(...);</span>
 
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">my_method</span><span class="operator">(</span> <span class="operator">{</span> <span class="string">'data'</span> <span class="operator">=&gt;</span> <span class="number">42</span><span class="operator">,</span>
                    <span class="string">'flag'</span> <span class="operator">=&gt;</span> <span class="string">'true'</span> <span class="operator">}</span><span class="operator">,</span>
                  <span class="string">'param'</span> <span class="operator">=&gt;</span> <span class="string">'foo'</span> <span class="operator">);</span>
</code></code></pre>

<h1 id="ARGUMENT-VALIDATION">ARGUMENT VALIDATION</h1>

<p>A number of users have asked about argument validation for methods: <a href="http://www.cpanforum.com/threads/3204">http://www.cpanforum.com/threads/3204</a>. For this, I recommend using <a>Params::Validate</a>:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Foo</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
     <span class="keyword">use</span> <span class="variable">Params::Validate</span> <span class="string">':all'</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> foo
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
         <span class="keyword">my</span> <span class="variable">%args</span> <span class="operator">=</span> <span class="variable">validate</span><span class="operator">(</span><span class="variable">@_</span><span class="operator">,</span> <span class="operator">{</span> <span class="string">bar</span> <span class="operator">=&gt;</span> <span class="number">1</span> <span class="operator">}</span><span class="operator">);</span>
         <span class="keyword">my</span> <span class="variable">$bar</span> <span class="operator">=</span> <span class="variable">$args</span><span class="operator">{</span><span class="string">bar</span><span class="operator">}</span><span class="operator">;</span>
         <span class="operator">...</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Using <a>Attribute::Params::Validate</a>, attributes are used for argument validation specifications:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Foo</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
     <span class="keyword">use</span> <span class="variable">Attribute::Params::Validate</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> foo :method :Validate</span><span class="operator">(</span>bar =&gt; 1<span class="operator">)</span>
     <span class="operator">{</span>
         <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
         <span class="keyword">my</span> <span class="variable">%args</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
         <span class="keyword">my</span> <span class="variable">$bar</span> <span class="operator">=</span> <span class="variable">$args</span><span class="operator">{</span><span class="string">bar</span><span class="operator">}</span><span class="operator">;</span>
         <span class="operator">...</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Note that in the above, Perl&#39;s <code><code>:method</code></code> attribute (in all lowercase) is needed.</p>

<p>There is some incompatibility between Attribute::Params::Validate and some of Object::InsideOut&#39;s attributes. Namely, you cannot use <code><code>:Validate</code></code> with <code><code>:Private</code></code>, <code><code>:Restricted</code></code>, <code><code>:Cumulative</code></code>, <code><code>:Chained</code></code> or <code><code>:MergeArgs</code></code>. In these cases, use the <code><code>validate()</code></code> function from <a>Params::Validate</a> instead.</p>

<h1 id="AUTOMETHODS">AUTOMETHODS</h1>

<p>There are significant issues related to Perl&#39;s <code><code>AUTOLOAD</code></code> mechanism that cause it to be ill-suited for use in a class hierarchy. Therefore, Object::InsideOut implements its own <code><code>:Automethod</code></code> mechanism to overcome these problems.</p>

<p>Classes requiring <code><code>AUTOLOAD</code></code>-type capabilities must provided a subroutine labeled with the <code><code>:Automethod</code></code> attribute. The <code><code>:Automethod</code></code> subroutine will be called with the object and the arguments in the original method call (the same as for <code><code>AUTOLOAD</code></code>). The <code><code>:Automethod</code></code> subroutine should return either a subroutine reference that implements the requested method&#39;s functionality, or else just end with <code><code><span class="keyword">return</span><span class="operator">;</span>
</code></code> to indicate that it doesn&#39;t know how to handle the request.</p>

<p>Using its own <code><code>AUTOLOAD</code></code> subroutine (which is exported to every class), Object::InsideOut walks through the class tree, calling each <code><code>:Automethod</code></code> subroutine, as needed, to fulfill an unimplemented method call.</p>

<p>The name of the method being called is passed as <code><code>$_</code></code> instead of <code><code>$AUTOLOAD</code></code>, and is <i>not</i> prefixed with the class name. If the <code><code>:Automethod</code></code> subroutine also needs to access the <code><code>$_</code></code> from the caller&#39;s scope, it is available as <code><code>$CALLER::_</code></code>.</p>

<p>Automethods can also be made to act as <a href="#CUMULATIVE-METHODS">&quot;CUMULATIVE METHODS&quot;</a> or <a href="#CHAINED-METHODS">&quot;CHAINED METHODS&quot;</a>. In these cases, the <code><code>:Automethod</code></code> subroutine should return two values: The subroutine ref to handle the method call, and a string designating the type of method. The designator has the same form as the attributes used to designate <code><code>:Cumulative</code></code> and <code><code>:Chained</code></code> methods:</p>

<pre><code><code> &#39;:Cumulative&#39;  or  &#39;:Cumulative(top down)&#39;
 &#39;:Cumulative(bottom up)&#39;
 &#39;:Chained&#39;     or  &#39;:Chained(top down)&#39;
 &#39;:Chained(bottom up)&#39;</code></code></pre>

<p>The following skeletal code illustrates how an <code><code>:Automethod</code></code> subroutine could be structured:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> _automethod :Automethod
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
     <span class="keyword">my</span> <span class="variable">@args</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
     <span class="keyword">my</span> <span class="variable">$method_name</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">;</span>
 
     <span class="comment"># This class can handle the method directly</span>
     <span class="keyword">if</span> <span class="operator">(...)</span> <span class="operator">{</span>
         <span class="keyword">my</span> <span class="variable">$handler</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
             <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
             <span class="operator">...</span>
             <span class="keyword">return</span> <span class="operator">...;</span>
         <span class="operator">};</span>
 
         <span class="comment">### OPTIONAL ###</span>
         <span class="comment"># Install the handler so it gets called directly next time</span>
         <span class="comment"># no strict refs;</span>
         <span class="comment"># *{__PACKAGE__.'::'.$method_name} = $handler;</span>
         <span class="comment">################</span>
 
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$handler</span><span class="operator">);</span>
     <span class="operator">}</span>
 
     <span class="comment"># This class can handle the method as part of a chain</span>
     <span class="keyword">if</span> <span class="operator">(...)</span> <span class="operator">{</span>
         <span class="keyword">my</span> <span class="variable">$chained_handler</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
             <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
             <span class="operator">...</span>
             <span class="keyword">return</span> <span class="operator">...;</span>
         <span class="operator">};</span>
 
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$chained_handler</span><span class="operator">,</span> <span class="string">':Chained'</span><span class="operator">);</span>
     <span class="operator">}</span>
 
     <span class="comment"># This class cannot handle the method request</span>
     <span class="keyword">return</span><span class="operator">;</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Note: The <i>OPTIONAL</i> code above for installing the generated handler as a method should not be used with <code><code>:Cumulative</code></code> or <code><code>:Chained</code></code> automethods.</p>

<h1 id="OBJECT-SERIALIZATION">OBJECT SERIALIZATION</h1>

<h2 id="Basic-Serialization">Basic Serialization</h2>

<dl>

<dt id="my-array_ref-obj-dump-">my $array_ref = $obj-&gt;dump();</dt>
<dd>

</dd>
<dt id="my-string-obj-dump-1-">my $string = $obj-&gt;dump(1);</dt>
<dd>

<p>Object::InsideOut exports a method called <code><code>-&gt;dump()</code></code> to each class that returns either a <i>Perl</i> or a string representation of the object that invokes the method.</p>

<p>The <i>Perl</i> representation is returned when <code><code>-&gt;dump()</code></code> is called without arguments. It consists of an array ref whose first element is the name of the object&#39;s class, and whose second element is a hash ref containing the object&#39;s data. The object data hash ref contains keys for each of the classes that make up the object&#39;s hierarchy. The values for those keys are hash refs containing <span style="white-space: nowrap;"><code><code>key =&gt; value</code></code></span> pairs for the object&#39;s fields. For example:</p>

<pre><code><code> <span class="operator">[</span>
   <span class="string">'My::Class::Sub'</span><span class="operator">,</span>
   <span class="operator">{</span>
     <span class="string">'My::Class'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
                      <span class="string">'data'</span> <span class="operator">=&gt;</span> <span class="string">'value'</span>
                    <span class="operator">}</span><span class="operator">,</span>
     <span class="string">'My::Class::Sub'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
                           <span class="string">'life'</span> <span class="operator">=&gt;</span> <span class="number">42</span>
                         <span class="operator">}</span>
   <span class="operator">}</span>
 <span class="operator">]</span>
</code></code></pre>

<p>The name for an object field (<i>data</i> and <i>life</i> in the example above) can be specified by adding the <code><code>:Name</code></code> attribute to the field:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@life</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Name</span><span class="operator">(</span><span class="variable">life</span><span class="operator">);</span>
</code></code></pre>

<p>If the <code><code>:Name</code></code> attribute is not used, then the name for a field will be either the name associated with an <code><code>:All</code></code> or <code><code>:Arg</code></code> attribute, its <i>get</i> method name, its <i>set</i> method name, or, failing all that, a string of the form <code><code>ARRAY(0x...)</code></code> or <code><code>HASH(0x...)</code></code>.</p>

<p>When called with a <i>true</i> argument, <code><code>-&gt;dump()</code></code> returns a string version of the <i>Perl</i> representation using <a href="../../../lib/Data/Dumper.html">Data::Dumper</a>.</p>

<p>Note that using <a href="../../../lib/Data/Dumper.html">Data::Dumper</a> directly on an inside-out object will not produce the desired results (it&#39;ll just output the contents of the scalar ref). Also, if inside-out objects are stored inside other structures, a dump of those structures will not contain the contents of the object&#39;s fields.</p>

<p>In the event of a method naming conflict, the <code><code>-&gt;dump()</code></code> method can be called using its fully-qualified name:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$dump</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">Object::InsideOut::dump</span><span class="operator">();</span>
</code></code></pre>

</dd>
<dt id="my-obj-Object::InsideOut-pump-data-">my $obj = Object::InsideOut-&gt;pump($data);</dt>
<dd>

<p><code><code>Object::InsideOut-&gt;pump()</code></code> takes the output from the <code><code>-&gt;dump()</code></code> method, and returns an object that is created using that data. If <code><code>$data</code></code> is the array ref returned by using <code><code>$obj-&gt;dump()</code></code>, then the data is inserted directly into the corresponding fields for each class in the object&#39;s class hierarchy. If <code><code>$data</code></code> is the string returned by using <code><code>$obj-&gt;dump(1)</code></code>, then it is <code><code>eval</code></code>ed to turn it into an array ref, and then processed as above.</p>

<p><b>Caveats</b>: If any of an object&#39;s fields are dumped to field name keys of the form <code><code>ARRAY(0x...)</code></code> or <code><code>HASH(0x...)</code></code> (see above), then the data will not be reloadable using <code><code>Object::InsideOut-&gt;pump()</code></code>. To overcome this problem, the class developer must either add <code><code>:Name</code></code> attributes to the <code><code>:Field</code></code> declarations (see above), or provide a <code><code>:Dumper</code></code>/<code><code>:Pumper</code></code> pair of subroutines as described below.</p>

<p>Dynamically altering a class (e.g., using <a href="#DYNAMIC-FIELD-CREATION">-&gt;create_field()</a>) after objects have been dumped will result in <code><code>undef</code></code> fields when pumped back in regardless of whether or not the added fields have defaults.</p>

<p>Modifying the output from <code><code>-&gt;dump()</code></code>, and then feeding it into <code><code>Object::InsideOut-&gt;pump()</code></code> will work, but is not specifically supported. If you know what you&#39;re doing, fine, but you&#39;re on your own.</p>

</dd>
<dt id="Dumper-Subroutine-Attribute"><code><code>:Dumper</code></code> Subroutine Attribute</dt>
<dd>

<p>If a class requires special processing to dump its data, then it can provide a subroutine labeled with the <code><code>:Dumper</code></code> attribute. This subroutine will be sent the object that is being dumped. It may then return any type of scalar the developer deems appropriate. Usually, this would be a hash ref containing <span style="white-space: nowrap;"><code><code>key =&gt; value</code></code></span> pairs for the object&#39;s fields. For example:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span><span class="operator">;</span>
 
 <span class="keyword">sub</span><span class="variable"> _dump :Dumper
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">;</span>
 
     <span class="keyword">my</span> <span class="variable">%field_data</span><span class="operator">;</span>
     <span class="variable">$field_data</span><span class="operator">{</span><span class="string">'data'</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$data</span><span class="operator">[</span><span class="variable">$$obj</span><span class="operator">]</span><span class="operator">;</span>
 
     <span class="keyword">return</span> <span class="operator">(\</span><span class="variable">%field_data</span><span class="operator">);</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Just be sure not to call your <code><code>:Dumper</code></code> subroutine <code><code>dump</code></code> as that is the name of the dump method exported by Object::InsideOut as explained above.</p>

</dd>
<dt id="Pumper-Subroutine-Attribute"><code><code>:Pumper</code></code> Subroutine Attribute</dt>
<dd>

<p>If a class supplies a <code><code>:Dumper</code></code> subroutine, it will most likely need to provide a complementary <code><code>:Pumper</code></code> labeled subroutine that will be used as part of creating an object from dumped data using <code><code>Object::InsideOut-&gt;pump()</code></code>. The subroutine will be supplied the new object that is being created, and whatever scalar was returned by the <code><code>:Dumper</code></code> subroutine. The corresponding <code><code>:Pumper</code></code> for the example <code><code>:Dumper</code></code> above would be:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> _pump :Pumper
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$obj</span><span class="operator">,</span> <span class="variable">$field_data</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
     <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">set</span><span class="operator">(\</span><span class="variable">@data</span><span class="operator">,</span> <span class="variable">$field_data</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'data'</span><span class="operator">}</span><span class="operator">);</span>
 <span class="operator">}</span>
</code></code></pre>

</dd>
</dl>

<h2 id="Storable">Storable</h2>

<p>Object::InsideOut also supports object serialization using the <a href="../../../lib/Storable.html">Storable</a> module. There are two methods for specifying that a class can be serialized using <a href="../../../lib/Storable.html">Storable</a>. The first method involves adding <a href="../../../lib/Storable.html">Storable</a> to the Object::InsideOut declaration in your package:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(Storable)</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>and adding <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">Storable</span><span class="operator">;</span>
</code></code></span> in your application. Then you can use the <code><code>-&gt;store()</code></code> and <code><code>-&gt;freeze()</code></code> methods to serialize your objects, and the <code><code>retrieve()</code></code> and <code><code>thaw()</code></code> subroutines to de-serialize them.</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">Storable</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">My::Class</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(...);</span>
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">store</span><span class="operator">(</span><span class="string">'/tmp/object.dat'</span><span class="operator">);</span>
 <span class="operator">...</span>
 <span class="keyword">my</span> <span class="variable">$obj2</span> <span class="operator">=</span> <span class="variable">retrieve</span><span class="operator">(</span><span class="string">'/tmp/object.dat'</span><span class="operator">);</span>
</code></code></pre>

<p>The other method of specifying <a href="../../../lib/Storable.html">Storable</a> serialization involves setting a <span style="white-space: nowrap;"><code><code>::storable</code></code></span> variable inside a <code><code>BEGIN</code></code> block for the class prior to its use:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">Storable</span><span class="operator">;</span>
 
 <span class="keyword">BEGIN</span> <span class="operator">{</span>
     <span class="variable">$My::Class::storable</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>
 <span class="operator">}</span>
 <span class="keyword">use</span> <span class="variable">My::Class</span><span class="operator">;</span>
</code></code></pre>

<p>NOTE: The <i>caveats</i> discussed above for the <code><code>-&gt;pump()</code></code> method are also applicable when using the Storable module.</p>

<h1 id="OBJECT-COERCION">OBJECT COERCION</h1>

<p>Object::InsideOut provides support for various forms of object coercion through the <a href="../../../lib/overload.html">overload</a> mechanism. For instance, if you want an object to be usable directly in a string, you would supply a subroutine in your class labeled with the <code><code>:Stringify</code></code> attribute:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> as_string :Stringify
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">;</span>
     <span class="keyword">my</span> <span class="variable">$string</span> <span class="operator">=</span> <span class="operator">...;</span>
     <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$string</span><span class="operator">);</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Then you could do things like:</p>

<pre><code><code> <span class="keyword">print</span><span class="operator">(</span><span class="string">"The object says, '</span><span class="variable">$obj</span><span class="string">'\n"</span><span class="operator">);</span>
</code></code></pre>

<p>For a boolean context, you would supply:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> as_bool :Boolify
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">;</span>
     <span class="keyword">my</span> <span class="variable">$true_or_false</span> <span class="operator">=</span> <span class="operator">...;</span>
     <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$true_or_false</span><span class="operator">);</span>
 <span class="operator">}</span>
</code></code></pre>

<p>and use it in this manner:</p>

<pre><code><code> <span class="keyword">if</span> <span class="operator">(!</span> <span class="keyword">defined</span><span class="operator">(</span><span class="variable">$obj</span><span class="operator">))</span> <span class="operator">{</span>
     <span class="comment"># The object is undefined</span>
     <span class="operator">....</span>
 
 <span class="operator">}</span> <span class="keyword">elsif</span> <span class="operator">(!</span> <span class="variable">$obj</span><span class="operator">)</span> <span class="operator">{</span>
     <span class="comment"># The object returned a false value</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>The following coercion attributes are supported:</p>

<dl>

<dt id="Stringify">:Stringify</dt>
<dd>

</dd>
<dt id="Numerify">:Numerify</dt>
<dd>

</dd>
<dt id="Boolify">:Boolify</dt>
<dd>

</dd>
<dt id="Arrayify">:Arrayify</dt>
<dd>

</dd>
<dt id="Hashify">:Hashify</dt>
<dd>

</dd>
<dt id="Globify">:Globify</dt>
<dd>

</dd>
<dt id="Codify">:Codify</dt>
<dd>

</dd>
</dl>

<p>Coercing an object to a scalar (<code><code>:Scalarify</code></code>) is <b>not</b> supported as <code><code>$$obj</code></code> is the ID of the object and cannot be overridden.</p>

<h1 id="CLONING">CLONING</h1>

<h2 id="Object-Cloning">Object Cloning</h2>

<p>Copies of objects can be created using the <code><code>-&gt;clone()</code></code> method which is exported by Object::InsideOut to each class:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj2</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">clone</span><span class="operator">();</span>
</code></code></pre>

<p>When called without arguments, <code><code>-&gt;clone()</code></code> creates a <i>shallow</i> copy of the object, meaning that any complex data structures (i.e., array, hash or scalar refs) stored in the object will be shared with its clone.</p>

<p>Calling <code><code>-&gt;clone()</code></code> with a <i>true</i> argument:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj2</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">clone</span><span class="operator">(</span><span class="number">1</span><span class="operator">);</span>
</code></code></pre>

<p>creates a <i>deep</i> copy of the object such that internally held array, hash or scalar refs are <i>replicated</i> and stored in the newly created clone.</p>

<p><i>Deep</i> cloning can also be controlled at the field level, and is covered in the next section.</p>

<p>Note that cloning does not clone internally held objects. For example, if <code><code>$foo</code></code> contains a reference to <code><code>$bar</code></code>, a clone of <code><code>$foo</code></code> will also contain a reference to <code><code>$bar</code></code>; not a clone of <code><code>$bar</code></code>. If such behavior is needed, it must be provided using a <a href="#Object-Replication">:Replicate</a> subroutine.</p>

<h2 id="Field-Cloning">Field Cloning</h2>

<p>Object cloning can be controlled at the field level such that specified fields are <i>deeply</i> copied when <code><code>-&gt;clone()</code></code> is called without any arguments. This is done by adding the <code><code>:Deep</code></code> attribute to the field:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Deep</span><span class="operator">;</span>
</code></code></pre>

<h1 id="WEAK-FIELDS">WEAK FIELDS</h1>

<p>Frequently, it is useful to store <a href="../../../lib/Scalar/Util.html#weaken-REF">weaken</a>ed references to data or objects in a field. Such a field can be declared as <code><code>:Weak</code></code> so that data (i.e., references) set via Object::InsideOut generated accessors, parameter processing using <code><code>:Arg</code></code>, the <code><code>-&gt;set()</code></code> method, etc., will automatically be <a href="../../../lib/Scalar/Util.html#weaken-REF">weaken</a>ed after being stored in the field array/hash.</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Weak</span><span class="operator">;</span>
</code></code></pre>

<p>NOTE: If data in a <i>weak</i> field is set directly (i.e., the <code><code>-&gt;set()</code></code> method is not used), then <a href="../../../lib/Scalar/Util.html#weaken-REF">weaken()</a> must be invoked on the stored reference afterwards:</p>

<pre><code><code> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">set</span><span class="operator">(\</span><span class="variable">@field</span><span class="operator">,</span> <span class="variable">$data</span><span class="operator">);</span>
 <span class="variable">Scalar::Util::weaken</span><span class="operator">(</span><span class="variable">$field</span><span class="operator">[</span><span class="variable">$$self</span><span class="operator">]</span><span class="operator">);</span>
</code></code></pre>

<p>(This is another reason why the <code><code>-&gt;set()</code></code> method is recommended for setting field data within class code.)</p>

<h1 id="DYNAMIC-FIELD-CREATION">DYNAMIC FIELD CREATION</h1>

<p>Normally, object fields are declared as part of the class code. However, some classes may need the capability to create object fields <i>on-the-fly</i>, for example, as part of an <code><code>:Automethod</code></code>. Object::InsideOut provides a class method for this:</p>

<pre><code><code> <span class="comment"># Dynamically create a hash field with standard accessors</span>
 <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">create_field</span><span class="operator">(</span><span class="string">'%'</span><span class="operator">.</span><span class="variable">$fld</span><span class="operator">,</span> <span class="string">":Std(</span><span class="variable">$fld</span><span class="string">)"</span><span class="operator">);</span>
</code></code></pre>

<p>The first argument is the class into which the field will be added. The second argument is a string containing the name of the field preceded by either a <code><code>@</code></code> or <code><code>%</code></code> to declare an array field or hash field, respectively. The remaining string arguments should be attributes declaring accessors and the like. The <code><code>:Field</code></code> attribute is assumed, and does not need to be added to the attribute list. For example:</p>

<pre><code><code> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">create_field</span><span class="operator">(</span><span class="string">'@data'</span><span class="operator">,</span> <span class="string">":Type(numeric)"</span><span class="operator">,</span>
                                  <span class="string">":Acc(data)"</span><span class="operator">);</span>
 
 <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">create_field</span><span class="operator">(</span><span class="string">'@obj'</span><span class="operator">,</span> <span class="string">":Type(Some::Class)"</span><span class="operator">,</span>
                                 <span class="string">":Acc(obj)"</span><span class="operator">,</span>
                                 <span class="string">":Weak"</span><span class="operator">);</span>
</code></code></pre>

<p>Field creation will fail if you try to create an array field within a class whose hierarchy has been declared <a href="#HASH-ONLY-CLASSES">:hash_only</a>.</p>

<p>Here&#39;s an example of an <code><code>:Automethod</code></code> subroutine that uses dynamic field creation:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> _automethod :Automethod
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">;</span>
         <span class="keyword">my</span> <span class="variable">$class</span> <span class="operator">=</span> <span class="keyword">ref</span><span class="operator">(</span><span class="variable">$self</span><span class="operator">)</span> <span class="operator">||</span> <span class="variable">$self</span><span class="operator">;</span>
         <span class="keyword">my</span> <span class="variable">$method</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">;</span>
 
         <span class="comment"># Extract desired field name from get_/set_ method name</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$fld_name</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">$method</span> <span class="operator">=~</span> <span class="regex">/^[gs]et_(.*)$/</span><span class="operator">;</span>
         <span class="keyword">if</span> <span class="operator">(!</span> <span class="variable">$fld_name</span><span class="operator">)</span> <span class="operator">{</span>
             <span class="keyword">return</span><span class="operator">;</span>    <span class="comment"># Not a recognized method</span>
         <span class="operator">}</span>
 
         <span class="comment"># Create the field and its standard accessors</span>
         <span class="variable">$class</span><span class="operator">-&gt;</span><span class="variable">create_field</span><span class="operator">(</span><span class="string">'@'</span><span class="operator">.</span><span class="variable">$fld_name</span><span class="operator">,</span> <span class="string">":Std(</span><span class="variable">$fld_name</span><span class="string">)"</span><span class="operator">);</span>
 
         <span class="comment"># Return code ref for newly created accessor</span>
         <span class="keyword">no</span> <span class="variable">strict</span> <span class="string">'refs'</span><span class="operator">;</span>
         <span class="keyword">return</span> <span class="variable">*</span><span class="operator">{</span><span class="variable">$class</span><span class="operator">.</span><span class="string">'::'</span><span class="operator">.</span><span class="variable">$method</span><span class="operator">}{</span><span class="string">'CODE'</span><span class="operator">}</span><span class="operator">;</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<h1 id="RUNTIME-INHERITANCE">RUNTIME INHERITANCE</h1>

<p>The class method <code><code>-&gt;add_class()</code></code> provides the capability to dynamically add classes to a class hierarchy at runtime.</p>

<p>For example, suppose you had a simple <i>state</i> class:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">Trait::State</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">my</span> <span class="variable">%state</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Set</span><span class="operator">(</span><span class="keyword">state</span><span class="operator">);</span>
 <span class="operator">}</span>
</code></code></pre>

<p>This could be added to another class at runtime using:</p>

<pre><code><code> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">add_class</span><span class="operator">(</span><span class="string">'Trait::State'</span><span class="operator">);</span>
</code></code></pre>

<p>This permits, for example, application code to dynamically modify a class without having it create an actual sub-class.</p>

<h1 id="PREPROCESSING">PREPROCESSING</h1>

<h2 id="Parameter-Preprocessing">Parameter Preprocessing</h2>

<p>You can specify a code ref (either in the form of an anonymous subroutine, or a subroutine name) for an object initialization parameter that will be called on that parameter prior to taking any of the other parameter actions described above. Here&#39;s an example:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="comment"># The parameter preprocessing subroutine</span>
     <span class="keyword">sub</span><span class="variable"> preproc
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$class</span><span class="operator">,</span> <span class="variable">$param</span><span class="operator">,</span> <span class="variable">$spec</span><span class="operator">,</span> <span class="variable">$obj</span><span class="operator">,</span> <span class="variable">$value</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="comment"># Preform parameter preprocessing</span>
         <span class="operator">...</span>
 
         <span class="comment"># Return result</span>
         <span class="keyword">return</span> <span class="operator">...;</span>
     <span class="operator">}</span>
 
     <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span>
              <span class="operator">:</span><span class="variable">Arg</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'DATA'</span><span class="operator">,</span> <span class="string">'Preprocess'</span> <span class="operator">=&gt;</span> <span class="operator">\&amp;</span><span class="variable">My::Class::preproc</span><span class="operator">);</span>
 
     <span class="keyword">my</span> <span class="variable">%init_args</span> <span class="operator">:</span><span class="variable">InitArgs</span> <span class="operator">=</span> <span class="operator">(</span>
         <span class="string">'PARAM'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
             <span class="string">'Preprocess'</span> <span class="operator">=&gt;</span> <span class="operator">\&amp;</span><span class="variable">preproc</span><span class="operator">,</span>
         <span class="operator">}</span><span class="operator">,</span>
     <span class="operator">);</span>
 
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>When used in the <code><code>:Arg</code></code> attribute, the subroutine name must be fully-qualified, as illustrated. Further, if not referenced in the <code><code>:InitArgs</code></code> hash, the preprocessing subroutine can be given the <code><code>:Private</code></code> attribute.</p>

<p>As the above illustrates, the parameter preprocessing subroutine is sent five arguments:</p>

<ul>

<li><p>The name of the class associated with the parameter</p>

<p>This would be <code><code>My::Class</code></code> in the example above.</p>

</li>
<li><p>The name of the parameter</p>

<p>Either <code><code>DATA</code></code> or <code><code>PARAM</code></code> in the example above.</p>

</li>
<li><p>A hash ref of the parameter&#39;s specifiers</p>

<p>This is either a hash ref containing the <code><code>:Arg</code></code> attribute parameters, or the hash ref paired to the parameter&#39;s key in the <code><code>:InitArgs</code></code> hash.</p>

</li>
<li><p>The object being initialized</p>

</li>
<li><p>The parameter&#39;s value</p>

<p>This is the value assigned to the parameter in the <code><code>-&gt;new()</code></code> method&#39;s argument list. If the parameter was not provided to <code><code>-&gt;new()</code></code>, then <code><code>undef</code></code> will be sent.</p>

</li>
</ul>

<p>The return value of the preprocessing subroutine will then be assigned to the parameter.</p>

<p>Be careful about what types of data the preprocessing subroutine tries to make use of <code><code>external</code></code> to the arguments supplied. For instance, because the order of parameter processing is not specified, the preprocessing subroutine cannot rely on whether or not some other parameter is set. Such processing would need to be done in the <code><code>:Init</code></code> subroutine. It can, however, make use of object data set by classes <i>higher up</i> in the class hierarchy. (That is why the object is provided as one of the arguments.)</p>

<p>Possible uses for parameter preprocessing include:</p>

<ul>

<li><p>Overriding the supplied value (or even deleting it by returning <code><code>undef</code></code>)</p>

</li>
<li><p>Providing a dynamically-determined default value</p>

</li>
</ul>

<p><i>Preprocess</i> may be abbreviated to <i>Preproc</i> or <i>Pre</i>.</p>

<h2 id="Set-Accessor-Preprocessing"><i>Set</i> Accessor Preprocessing</h2>

<p>You can specify a code ref (either in the form of an anonymous subroutine, or a fully-qualified subroutine name) for a <i>set/combined</i> accessor that will be called on the arguments supplied to the accessor prior to its taking the usual actions of type checking and adding the data to the field. Here&#39;s an example:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span>
              <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="string">'Name'</span> <span class="operator">=&gt;</span> <span class="string">'data'</span><span class="operator">,</span> <span class="string">'Preprocess'</span> <span class="operator">=&gt;</span> <span class="operator">\&amp;</span><span class="variable">My::Class::preproc</span><span class="operator">);</span>
 
     <span class="comment"># The set accessor preprocessing subroutine may be made 'Private'</span>
     <span class="keyword">sub</span><span class="variable"> preproc :Private
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$field</span><span class="operator">,</span> <span class="variable">@args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="comment"># Preform preprocessing on the accessor's arguments</span>
         <span class="operator">...</span>
 
         <span class="comment"># Return result</span>
         <span class="keyword">return</span> <span class="operator">...;</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>As the above illustrates, the accessor preprocessing subroutine is sent the following arguments:</p>

<ul>

<li><p>The object used to invoke the accessor</p>

</li>
<li><p>A reference to the field associated with the accessor</p>

</li>
<li><p>The argument(s) sent to the accessor</p>

<p>There will always be at least one argument.</p>

</li>
</ul>

<p>Usually, the preprocessing subroutine would return just a single value. For fields declared as type <code><code>List</code></code>, multiple values may be returned.</p>

<p>Following preprocessing, the <i>set</i> accessor will operate on whatever value(s) are returned by the preprocessing subroutine.</p>

<h1 id="SPECIAL-PROCESSING">SPECIAL PROCESSING</h1>

<h2 id="Object-ID">Object ID</h2>

<p>By default, the ID of an object is derived from a sequence counter for the object&#39;s class hierarchy. This should suffice for nearly all cases of class development. If there is a special need for the module code to control the object ID (see <a>Math::Random::MT::Auto</a> as an example), then a subroutine labelled with the <code><code>:ID</code></code> attribute can be specified:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> _id :ID
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$class</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">;</span>
 
     <span class="comment"># Generate/determine a unique object ID</span>
     <span class="operator">...</span>
 
     <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$id</span><span class="operator">);</span>
 <span class="operator">}</span>
</code></code></pre>

<p>The ID returned by your subroutine can be any kind of <i>regular</i> scalar (e.g., a string or a number). However, if the ID is something other than a low-valued integer, then you will have to architect <b>all</b> your classes using hashes for the object fields. See <a href="#HASH-ONLY-CLASSES">&quot;HASH ONLY CLASSES&quot;</a> for details.</p>

<p>Within any class hierarchy, only one class may specify an <code><code>:ID</code></code> subroutine.</p>

<h2 id="Object-Replication">Object Replication</h2>

<p>Object replication occurs explicitly when the <code><code>-&gt;clone()</code></code> method is called on an object, and implicitly when threads are created in a threaded application. In nearly all cases, Object::InsideOut will take care of all the details for you.</p>

<p>In rare cases, a class may require special handling for object replication. It must then provide a subroutine labeled with the <code><code>:Replicate</code></code> attribute. This subroutine will be sent three arguments: The parent and the cloned objects, and a flag:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> _replicate :Replicate
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$parent</span><span class="operator">,</span> <span class="variable">$clone</span><span class="operator">,</span> <span class="variable">$flag</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
     <span class="comment"># Special object replication processing</span>
     <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$clone</span> <span class="keyword">eq</span> <span class="string">'CLONE'</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="comment"># Handling for thread cloning</span>
        <span class="operator">...</span>
     <span class="operator">}</span> <span class="keyword">elsif</span> <span class="operator">(</span><span class="variable">$clone</span> <span class="keyword">eq</span> <span class="string">'deep'</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="comment"># Deep copy of the parent</span>
        <span class="operator">...</span>
     <span class="operator">}</span> <span class="keyword">else</span> <span class="operator">{</span>
        <span class="comment"># Shallow copying</span>
        <span class="operator">...</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>In the case of thread cloning, <code><code>$flag</code></code> will be set to the <code><code>&#39;CLONE&#39;</code></code>, and the <code><code>$parent</code></code> object is just a non-blessed anonymous scalar reference that contains the ID for the object in the parent thread.</p>

<p>When invoked via the <code><code>-&gt;clone()</code></code> method, <code><code>$flag</code></code> will be either an empty string which denotes that a <i>shallow</i> copy is being produced for the clone, or <code><code>$flag</code></code> will be set to <code><code>&#39;deep&#39;</code></code> indicating a <i>deep</i> copy is being produced.</p>

<p>The <code><code>:Replicate</code></code> subroutine only needs to deal with the special replication processing needed by the object: Object::InsideOut will handle all the other details.</p>

<h2 id="Object-Destruction">Object Destruction</h2>

<p>Object::InsideOut exports a <code><code>DESTROY</code></code> method to each class that deletes an object&#39;s data from the object field arrays (hashes). If a class requires additional destruction processing (e.g., closing filehandles), then it must provide a subroutine labeled with the <code><code>:Destroy</code></code> attribute. This subroutine will be sent the object that is being destroyed:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> _destroy :Destroy
 </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">;</span>
 
     <span class="comment"># Special object destruction processing</span>
 <span class="operator">}</span>
</code></code></pre>

<p>The <code><code>:Destroy</code></code> subroutine only needs to deal with the special destruction processing: The <code><code>DESTROY</code></code> method will handle all the other details of object destruction.</p>

<h1 id="FOREIGN-CLASS-INHERITANCE">FOREIGN CLASS INHERITANCE</h1>

<p>Object::InsideOut supports inheritance from foreign (i.e., non-Object::InsideOut) classes. This means that your classes can inherit from other Perl class, and access their methods from your own objects.</p>

<p>One method of declaring foreign class inheritance is to add the class name to the Object::InsideOut declaration inside your package:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(Foreign::Class)</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>This allows you to access the foreign class&#39;s static (i.e., class) methods from your own class. For example, suppose <code><code>Foreign::Class</code></code> has a class method called <code><code>foo</code></code>. With the above, you can access that method using <code><code>My::Class-&gt;foo()</code></code> instead.</p>

<p>Multiple foreign inheritance is supported, as well:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(Foreign::Class Other::Foreign::Class)</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<dl>

<dt id="self-inherit-obj-...-">$self-&gt;inherit($obj, ...);</dt>
<dd>

<p>To use object methods from foreign classes, an object must <i>inherit</i> from an object of that class. This would normally be done inside a class&#39;s <code><code>:Init</code></code> subroutine:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(Foreign::Class)</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> init :Init
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
 
         <span class="keyword">my</span> <span class="variable">$foreign_obj</span> <span class="operator">=</span> <span class="variable">Foreign::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(...);</span>
         <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">inherit</span><span class="operator">(</span><span class="variable">$foreign_obj</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Thus, with the above, if <code><code>Foreign::Class</code></code> has an object method called <code><code>bar</code></code>, you can call that method from your own objects:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">bar</span><span class="operator">();</span>
</code></code></pre>

<p>Object::InsideOut&#39;s <code><code>AUTOLOAD</code></code> subroutine handles the dispatching of the <code><code>-&gt;bar()</code></code> method call using the internally held inherited object (in this case, <code><code>$foreign_obj</code></code>).</p>

<p>Multiple inheritance is supported, as well: You can call the <code><code>-&gt;inherit()</code></code> method multiple times, or make just one call with all the objects to be inherited from.</p>

<p><code><code>-&gt;inherit()</code></code> is a restricted method. In other words, you cannot use it on an object outside of code belonging to the object&#39;s class tree (e.g., you can&#39;t call it from application code).</p>

<p>In the event of a method naming conflict, the <code><code>-&gt;inherit()</code></code> method can be called using its fully-qualified name:</p>

<pre><code><code> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">Object::InsideOut::inherit</span><span class="operator">(</span><span class="variable">$obj</span><span class="operator">);</span>
</code></code></pre>

</dd>
<dt id="my-objs-self-heritage-">my @objs = $self-&gt;heritage();</dt>
<dd>

</dd>
<dt id="my-obj-self-heritage-class-">my $obj = $self-&gt;heritage($class);</dt>
<dd>

</dd>
<dt id="my-objs-self-heritage-class1-class2-...-">my @objs = $self-&gt;heritage($class1, $class2, ...);</dt>
<dd>

<p>Your class code can retrieve any inherited objects using the <code><code>-&gt;heritage()</code></code> method. When called without any arguments, it returns a list of any objects that were stored by the calling class using the calling object. In other words, if class <code><code>My::Class</code></code> uses object <code><code>$obj</code></code> to store foreign objects <code><code>$fobj1</code></code> and <code><code>$fobj2</code></code>, then later on in class <code><code>My::Class</code></code>, <code><code>$obj-&gt;heritage()</code></code> will return <code><code>$fobj1</code></code> and <code><code>$fobj2</code></code>.</p>

<p><code><code>-&gt;heritage()</code></code> can also be called with one or more class name arguments. In this case, only objects of the specified class(es) are returned.</p>

<p>In the event of a method naming conflict, the <code><code>-&gt;heritage()</code></code> method can be called using its fully-qualified name:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@objs</span> <span class="operator">=</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">Object::InsideOut::heritage</span><span class="operator">();</span>
</code></code></pre>

</dd>
<dt id="self-disinherit-class-...-">$self-&gt;disinherit($class [, ...])</dt>
<dd>

</dd>
<dt id="self-disinherit-obj-...-">$self-&gt;disinherit($obj [, ...])</dt>
<dd>

<p>The <code><code>-&gt;disinherit()</code></code> method disassociates (i.e., deletes) the inheritance of foreign object(s) from an object. The foreign objects may be specified by class, or using the actual inherited object (retrieved via <code><code>-&gt;heritage()</code></code>, for example).</p>

<p>The call is only effective when called inside the class code that established the initial inheritance. In other words, if an inheritance is set up inside a class, then disinheritance can only be done from inside that class.</p>

<p>In the event of a method naming conflict, the <code><code>-&gt;disinherit()</code></code> method can be called using its fully-qualified name:</p>

<pre><code><code> $self-&gt;Object::InsideOut::disinherit($obj [, ...])</code></code></pre>

</dd>
</dl>

<p><b>NOTE</b>: With foreign inheritance, you only have access to class and object methods. The encapsulation of the inherited objects is strong, meaning that only the class where the inheritance takes place has direct access to the inherited object. If access to the inherited objects themselves, or their internal hash fields (in the case of <i>blessed hash</i> objects), is needed outside the class, then you&#39;ll need to write your own accessors for that.</p>

<p><b>LIMITATION</b>: You cannot use fully-qualified method names to access foreign methods (when encapsulated foreign objects are involved). Thus, the following will not work:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">Foreign::Class::bar</span><span class="operator">();</span>
</code></code></pre>

<p>Normally, you shouldn&#39;t ever need to do the above: <code><code>$obj-&gt;bar()</code></code> would suffice.</p>

<p>The only time this may be an issue is when the <i>native</i> class <i>overrides</i> an inherited foreign class&#39;s method (e.g., <code><code>My::Class</code></code> has its own <code><code>-&gt;bar()</code></code> method). Such overridden methods are not directly callable. If such overriding is intentional, then this should not be an issue: No one should be writing code that tries to by-pass the override. However, if the overriding is accidentally, then either the <i>native</i> method should be renamed, or the <i>native</i> class should provide a wrapper method so that the functionality of the overridden method is made available under a different name.</p>

<h2 id="and-Fully-qualified-Method-Names"><code><code>use base</code></code> and Fully-qualified Method Names</h2>

<p>The foreign inheritance methodology handled by the above is predicated on non-Object::InsideOut classes that generate their own objects and expect their object methods to be invoked via those objects.</p>

<p>There are exceptions to this rule:</p>

<dl>

<dt id="Foreign-object-methods-that-expect-to-be-invoked-via-the-inheriting-classs-object-or-foreign-object-methods-that-dont-care-how-they-are-invoked-i.e.-they-dont-make-reference-to-the-invoking-object-.">1. Foreign object methods that expect to be invoked via the inheriting class&#39;s object, or foreign object methods that don&#39;t care how they are invoked (i.e., they don&#39;t make reference to the invoking object).</dt>
<dd>

<p>This is the case where a class provides auxiliary methods for your objects, but from which you don&#39;t actually create any objects (i.e., there is no corresponding foreign object, and <code><code>$obj-&gt;inherit($foreign)</code></code> is not used.)</p>

<p>In this case, you can either:</p>

<p>a. Declare the foreign class using the standard method (i.e., <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(Foreign::Class)</span><span class="operator">;</span>
</code></code></span>), and invoke its methods using their full path (e.g., <code><code><span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">Foreign::Class::method</span><span class="operator">();</span>
</code></code>); or</p>

<p>b. You can use the <a href="../../../lib/base.html">base</a> pragma so that you don&#39;t have to use the full path for foreign methods.</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
     <span class="keyword">use</span> <span class="variable">base</span> <span class="string">'Foreign::Class'</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>The former scheme is faster.</p>

</dd>
<dt id="Foreign-class-methods-that-expect-to-be-invoked-via-the-inheriting-class.">2. Foreign class methods that expect to be invoked via the inheriting class.</dt>
<dd>

<p>As with the above, you can either invoke the class methods using their full path (e.g., <code><code><span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">Foreign::Class::method</span><span class="operator">();</span>
</code></code>), or you can <span style="white-space: nowrap;"><code><code>use base</code></code></span> so that you don&#39;t have to use the full path. Again, using the full path is faster.</p>

<p><a>Class::Singleton</a> is an example of this type of class.</p>

</dd>
<dt id="Class-methods-that-dont-care-how-they-are-invoked-i.e.-they-dont-make-reference-to-the-invoking-class-.">3. Class methods that don&#39;t care how they are invoked (i.e., they don&#39;t make reference to the invoking class).</dt>
<dd>

<p>In this case, you can either use <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(Foreign::Class)</span><span class="operator">;</span>
</code></code></span> for consistency, or use <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">base</span> <span class="string">qw(Foreign::Class)</span><span class="operator">;</span>
</code></code></span> if (slightly) better performance is needed.</p>

</dd>
</dl>

<p>If you&#39;re not familiar with the inner workings of the foreign class such that you don&#39;t know if or which of the above exceptions applies, then the formulaic approach would be to first use the documented method for foreign inheritance (i.e., <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(Foreign::Class)</span><span class="operator">;</span>
</code></code></span>). If that works, then I strongly recommend that you just use that approach unless you have a good reason not to. If it doesn&#39;t work, then try <span style="white-space: nowrap;"><code><code>use base</code></code></span>.</p>

<h1 id="INTROSPECTION">INTROSPECTION</h1>

<p>For Perl 5.8.0 and later, Object::InsideOut provides an introspection API that allow you to obtain metadata on a class&#39;s hierarchy, constructor parameters, and methods.</p>

<dl>

<dt id="my-meta-My::Class-meta-">my $meta = My::Class-&gt;meta();</dt>
<dd>

</dd>
<dt id="my-meta-obj-meta-">my $meta = $obj-&gt;meta();</dt>
<dd>

<p>The <code><code>-&gt;meta()</code></code> method, which is exported by Object::InsideOut to each class, returns an <a href="../../../../../../public/home/fxing/.cpan/build/Object-InsideOut-3.98-wuUVde/blib/lib/Object/InsideOut/Metadata.html">Object::InsideOut::Metadata</a> object which can then be <i>queried</i> for information about the invoking class or invoking object&#39;s class:</p>

<pre><code><code> <span class="comment"># Get an object's class hierarchy</span>
 <span class="keyword">my</span> <span class="variable">@classes</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">meta</span><span class="operator">()-&gt;</span><span class="variable">get_classes</span><span class="operator">();</span>
 
 <span class="comment"># Get info on the args for a class's constructor (i.e., -&gt;new() parameters)</span>
 <span class="keyword">my</span> <span class="variable">%args</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">meta</span><span class="operator">()-&gt;</span><span class="variable">get_args</span><span class="operator">();</span>
 
 <span class="comment"># Get info on the methods that can be called by an object</span>
 <span class="keyword">my</span> <span class="variable">%methods</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">meta</span><span class="operator">()-&gt;</span><span class="variable">get_methods</span><span class="operator">();</span>
</code></code></pre>

</dd>
<dt id="My::Class-isa-">My::Class-&gt;isa();</dt>
<dd>

</dd>
<dt id="obj-isa-">$obj-&gt;isa();</dt>
<dd>

<p>When called in an array context, calling <code><code>-&gt;isa()</code></code> without any arguments on an Object::InsideOut class or object returns a list of the classes in the class hierarchy for that class or object, and is equivalent to:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">@classes</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">meta</span><span class="operator">()-&gt;</span><span class="variable">get_classes</span><span class="operator">();</span>
</code></code></pre>

<p>When called in a scalar context, it returns an array ref containing the classes.</p>

</dd>
<dt id="My::Class-can-">My::Class-&gt;can();</dt>
<dd>

</dd>
<dt id="obj-can-">$obj-&gt;can();</dt>
<dd>

<p>When called in an array context, calling <code><code>-&gt;can()</code></code> without any arguments on an Object::InsideOut class or object returns a list of the method names for that class or object, and is equivalent to:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">%methods</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">meta</span><span class="operator">()-&gt;</span><span class="variable">get_methods</span><span class="operator">();</span>
 <span class="keyword">my</span> <span class="variable">@methods</span> <span class="operator">=</span> <span class="keyword">keys</span><span class="operator">(</span><span class="variable">%methods</span><span class="operator">);</span>
</code></code></pre>

<p>When called in a scalar context, it returns an array ref containing the method names.</p>

</dd>
</dl>

<p>See <a href="../../../../../../public/home/fxing/.cpan/build/Object-InsideOut-3.98-wuUVde/blib/lib/Object/InsideOut/Metadata.html">Object::InsideOut::Metadata</a> for more details.</p>

<h1 id="THREAD-SUPPORT">THREAD SUPPORT</h1>

<p>For Perl 5.8.1 and later, Object::InsideOut fully supports <a href="../../../lib/threads.html">threads</a> (i.e., is thread safe), and supports the sharing of Object::InsideOut objects between threads using <a href="../../../lib/threads/shared.html">threads::shared</a>.</p>

<p>To use Object::InsideOut in a threaded application, you must put <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">threads</span><span class="operator">;</span>
</code></code></span> at the beginning of the application. (The use of <span style="white-space: nowrap;"><code><code><span class="keyword">require</span> <span class="variable">threads</span><span class="operator">;</span>
</code></code></span> after the program is running is not supported.) If object sharing is to be utilized, then <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">threads::shared</span><span class="operator">;</span>
</code></code></span> should follow.</p>

<p>If you just <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">threads</span><span class="operator">;</span>
</code></code></span>, then objects from one thread will be copied and made available in a child thread.</p>

<p>The addition of <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">threads::shared</span><span class="operator">;</span>
</code></code></span> in and of itself does not alter the behavior of Object::InsideOut objects. The default behavior is to <i>not</i> share objects between threads (i.e., they act the same as with <span style="white-space: nowrap;"><code><code><span class="keyword">use</span> <span class="variable">threads</span><span class="operator">;</span>
</code></code></span> alone).</p>

<p>To enable the sharing of objects between threads, you must specify which classes will be involved with thread object sharing. There are two methods for doing this. The first involves setting a <code><code>::shared</code></code> variable (inside a <code><code>BEGIN</code></code> block) for the class prior to its use:</p>

<pre><code><code> <span class="keyword">use</span> <span class="variable">threads</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">threads::shared</span><span class="operator">;</span>
 
 <span class="keyword">BEGIN</span> <span class="operator">{</span>
     <span class="variable">$My::Class::shared</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>
 <span class="operator">}</span>
 <span class="keyword">use</span> <span class="variable">My::Class</span><span class="operator">;</span>
</code></code></pre>

<p>The other method is for a class to add a <code><code>:SHARED</code></code> flag to its <span style="white-space: nowrap;"><code><code>use Object::InsideOut ...</code></code></span> declaration:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">':SHARED'</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>When either sharing flag is set for one class in an object hierarchy, then all the classes in the hierarchy are affected.</p>

<p>If a class cannot support thread object sharing (e.g., one of the object fields contains code refs [which Perl cannot share between threads]), it should specifically declare this fact:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">':NOT_SHARED'</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>However, you cannot mix thread object sharing classes with non-sharing classes in the same class hierarchy:</p>

<pre><code><code> <span class="keyword">use</span> <span class="variable">threads</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">threads::shared</span><span class="operator">;</span>
 
 <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">':SHARED'</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">Other::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">':NOT_SHARED'</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">My::Derived</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(My::Class Other::Class)</span><span class="operator">;</span>   <span class="comment"># ERROR!</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Here is a complete example with thread object sharing enabled:</p>

<pre><code><code> <span class="keyword">use</span> <span class="variable">threads</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">threads::shared</span><span class="operator">;</span>
 
 <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">':SHARED'</span><span class="operator">;</span>
 
     <span class="comment"># One list-type field</span>
     <span class="keyword">my</span> <span class="variable">@data</span> <span class="operator">:</span><span class="variable">Field</span> <span class="operator">:</span><span class="variable">Type</span><span class="operator">(</span><span class="variable">list</span><span class="operator">)</span> <span class="operator">:</span><span class="variable">Acc</span><span class="operator">(</span><span class="variable">data</span><span class="operator">);</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
 
 <span class="comment"># New object</span>
 <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 
 <span class="comment"># Set the object's 'data' field</span>
 <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">(</span><span class="string">qw(foo bar baz)</span><span class="operator">);</span>
 
 <span class="comment"># Print out the object's data</span>
 <span class="keyword">print</span><span class="operator">(</span><span class="keyword">join</span><span class="operator">(</span><span class="string">', '</span><span class="operator">,</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">()</span><span class="operator">}</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">);</span>       <span class="comment"># "foo, bar, baz"</span>
 
 <span class="comment"># Create a thread and manipulate the object's data</span>
 <span class="keyword">my</span> <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">threads</span><span class="operator">-&gt;</span><span class="variable">create</span><span class="operator">(</span>
         <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
             <span class="comment"># Read the object's data</span>
             <span class="keyword">my</span> <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">();</span>
             <span class="comment"># Print out the object's data</span>
             <span class="keyword">print</span><span class="operator">(</span><span class="keyword">join</span><span class="operator">(</span><span class="string">', '</span><span class="operator">,</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$data</span><span class="operator">}</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">);</span>  <span class="comment"># "foo, bar, baz"</span>
             <span class="comment"># Change the object's data</span>
             <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">(</span><span class="variable">@$data</span><span class="operator">[</span><span class="number">1</span><span class="operator">..</span><span class="number">2</span><span class="operator">]</span><span class="operator">,</span> <span class="string">'zooks'</span><span class="operator">);</span>
             <span class="comment"># Print out the object's modified data</span>
             <span class="keyword">print</span><span class="operator">(</span><span class="keyword">join</span><span class="operator">(</span><span class="string">', '</span><span class="operator">,</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">()</span><span class="operator">}</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">);</span>  <span class="comment"># "bar, baz, zooks"</span>
             <span class="keyword">return</span> <span class="operator">(</span><span class="number">1</span><span class="operator">);</span>
         <span class="operator">}</span>
     <span class="operator">)-&gt;</span><span class="variable">join</span><span class="operator">();</span>
 
 <span class="comment"># Show that changes in the object are visible in the parent thread</span>
 <span class="comment"># I.e., this shows that the object was indeed shared between threads</span>
 <span class="keyword">print</span><span class="operator">(</span><span class="keyword">join</span><span class="operator">(</span><span class="string">', '</span><span class="operator">,</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">data</span><span class="operator">()</span><span class="operator">}</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">);</span>       <span class="comment"># "bar, baz, zooks"</span>
</code></code></pre>

<h1 id="HASH-ONLY-CLASSES">HASH ONLY CLASSES</h1>

<p>For performance considerations, it is recommended that arrays be used for class fields whenever possible. The only time when hash-bases fields are required is when a class must provide its own <a href="#Object-ID">object ID</a>, and those IDs are something other than low-valued integers. In this case, hashes must be used for fields not only in the class that defines the object ID subroutine, but also in every class in any class hierarchy that include such a class.</p>

<p>The <i>hash only</i> requirement can be enforced by adding the <code><code>:HASH_ONLY</code></code> flag to a class&#39;s <span style="white-space: nowrap;"><code><code>use Object::InsideOut ...</code></code></span> declaration:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">':hash_only'</span><span class="operator">;</span>
 
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>This will cause Object::Inside to check every class in any class hierarchy that includes such flagged classes to make sure their fields are hashes and not arrays. It will also fail any <a href="#DYNAMIC-FIELD-CREATION">-&gt;create_field()</a> call that tries to create an array-based field in any such class.</p>

<h1 id="SECURITY">SECURITY</h1>

<p>In the default case where Object::InsideOut provides object IDs that are sequential integers, it is possible to hack together a <i>fake</i> Object::InsideOut object, and so gain access to another object&#39;s data:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$fake</span> <span class="operator">=</span> <span class="keyword">bless</span><span class="operator">(\</span><span class="keyword">do</span><span class="operator">{</span><span class="keyword">my</span> <span class="variable">$scalar</span><span class="operator">},</span> <span class="string">'Some::Class'</span><span class="operator">);</span>
 <span class="variable">$$fake</span> <span class="operator">=</span> <span class="number">86</span><span class="operator">;</span>   <span class="comment"># ID of another object</span>
 <span class="keyword">my</span> <span class="variable">$stolen</span> <span class="operator">=</span> <span class="variable">$fake</span><span class="operator">-&gt;</span><span class="variable">get_data</span><span class="operator">();</span>
</code></code></pre>

<p>Why anyone would try to do this is unknown. How this could be used for any sort of malicious exploitation is also unknown. However, if preventing this sort of security issue is a requirement, it can be accomplished by adding the <code><code>:SECURE</code></code> flag to a class&#39;s <span style="white-space: nowrap;"><code><code>use Object::InsideOut ...</code></code></span> declaration:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">':SECURE'</span><span class="operator">;</span>
 
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>This places the module <code><code>Object::InsideOut::Secure</code></code> in the class hierarchy. Object::InsideOut::Secure provides an <a href="#Object-ID">:ID subroutine</a> that generates random integers for object IDs, thus preventing other code from being able to create fake objects by <i>guessing</i> at IDs.</p>

<p>Using <code><code>:SECURE</code></code> mode requires <a>Math::Random::MT::Auto</a> (v5.04 or later).</p>

<p>Because the object IDs used with <code><code>:SECURE</code></code> mode are large random values, the <a href="#HASH-ONLY-CLASSES">:HASH_ONLY</a> flag is forced on all the classes in the hierarchy.</p>

<p>For efficiency, it is recommended that the <code><code>:SECURE</code></code> flag be added to the topmost class(es) in a hierarchy.</p>

<h1 id="ATTRIBUTE-HANDLERS">ATTRIBUTE HANDLERS</h1>

<p>Object::InsideOut uses <i>attribute &#39;modify&#39; handlers</i> as described in <a href="../../../lib/attributes.html#Package-specific-Attribute-Handling">&quot;Package-specific Attribute Handling&quot; in attributes</a>, and provides a mechanism for adding attribute handlers to your own classes. Instead of naming your attribute handler as <code><code>MODIFY_*_ATTRIBUTES</code></code>, name it something else and then label it with the <code><code>:MODIFY_*_ATTRIBUTES</code></code> attribute (or <code><code>:MOD_*_ATTRS</code></code> for short). Your handler should work just as described in <a href="../../../lib/attributes.html#Package-specific-Attribute-Handling">&quot;Package-specific Attribute Handling&quot; in attributes</a> with regard to its input arguments, and must return a list of the attributes which were not recognized by your handler. Here&#39;s an example:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> _scalar_attrs :MOD_SCALAR_ATTRS
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$pkg</span><span class="operator">,</span> <span class="variable">$scalar</span><span class="operator">,</span> <span class="variable">@attrs</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
         <span class="keyword">my</span> <span class="variable">@unused_attrs</span><span class="operator">;</span>         <span class="comment"># List of any unhandled attributes</span>
 
         <span class="keyword">while</span> <span class="operator">(</span><span class="keyword">my</span> <span class="variable">$attr</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">(</span><span class="variable">@attrs</span><span class="operator">))</span> <span class="operator">{</span>
             <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$attr</span> <span class="operator">=~</span> <span class="regex">/.../</span><span class="operator">)</span> <span class="operator">{</span>
                 <span class="comment"># Handle attribute</span>
                 <span class="operator">...</span>
             <span class="operator">}</span> <span class="keyword">else</span> <span class="operator">{</span>
                 <span class="comment"># We don't handle this attribute</span>
                 <span class="keyword">push</span><span class="operator">(</span><span class="variable">@unused_attrs</span><span class="operator">,</span> <span class="variable">$attr</span><span class="operator">);</span>
             <span class="operator">}</span>
         <span class="operator">}</span>
 
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">@unused_attrs</span><span class="operator">);</span>   <span class="comment"># Pass along unhandled attributes</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Attribute &#39;modify&#39; handlers are called <i>upward</i> through the class hierarchy (i.e., <i>bottom up</i>). This provides child classes with the capability to <i>override</i> the handling of attributes by parent classes, or to add attributes (via the returned list of unhandled attributes) for parent classes to process.</p>

<p>Attribute &#39;modify&#39; handlers should be located at the beginning of a package, or at least before any use of attributes on the corresponding type of variable or subroutine:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> _array_attrs :MOD_ARRAY_ATTRS
     </span><span class="operator">{</span>
        <span class="operator">...</span>
     <span class="operator">}</span>
 
     <span class="keyword">my</span> <span class="variable">@my_array</span> <span class="operator">:</span><span class="variable">MyArrayAttr</span><span class="operator">;</span>
 <span class="operator">}</span>
</code></code></pre>

<p>For <i>attribute &#39;fetch&#39; handlers</i>, follow the same procedures: Label the subroutine with the <code><code>:FETCH_*_ATTRIBUTES</code></code> attribute (or <code><code>:FETCH_*_ATTRS</code></code> for short). Contrary to the documentation in <a href="../../../lib/attributes.html#Package-specific-Attribute-Handling">&quot;Package-specific Attribute Handling&quot; in attributes</a>, <i>attribute &#39;fetch&#39; handlers</i> receive <b>two</b> arguments: The relevant package name, and a reference to a variable or subroutine for which package-defined attributes are desired.</p>

<p>Attribute handlers are normal rendered <a href="#Hidden-Methods">hidden</a>.</p>

<h1 id="SPECIAL-USAGE">SPECIAL USAGE</h1>

<h2 id="Usage-With">Usage With <code><code>Exporter</code></code></h2>

<p>It is possible to use <a href="../../../lib/Exporter.html">Exporter</a> to export functions from one inside-out object class to another:</p>

<pre><code><code> <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">warnings</span><span class="operator">;</span>
 
 <span class="keyword">package</span> <span class="variable">Foo</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">'Exporter'</span><span class="operator">;</span>
     <span class="keyword">BEGIN</span> <span class="operator">{</span>
         <span class="keyword">our</span> <span class="variable">@EXPORT_OK</span> <span class="operator">=</span> <span class="string">qw(foo_name)</span><span class="operator">;</span>
     <span class="operator">}</span>
 
     <span class="keyword">sub</span><span class="variable"> foo_name
     </span><span class="operator">{</span>
         <span class="keyword">return</span> <span class="operator">(</span><span class="keyword">__PACKAGE__</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">Bar</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">'Foo'</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="string">qw(foo_name)</span> <span class="operator">]</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> get_foo_name
     </span><span class="operator">{</span>
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">foo_name</span><span class="operator">());</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
 
 <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
 
 <span class="keyword">print</span><span class="operator">(</span><span class="string">"Bar got Foo's name as '"</span><span class="operator">,</span> <span class="variable">Bar::get_foo_name</span><span class="operator">(),</span> <span class="string">"'\n"</span><span class="operator">);</span>
</code></code></pre>

<p>Note that the <code><code>BEGIN</code></code> block is needed to ensure that the <a href="../../../lib/Exporter.html">Exporter</a> symbol arrays (in this case <code><code>@EXPORT_OK</code></code>) get populated properly.</p>

<h2 id="Usage-With-and">Usage With <code><code>require</code></code> and <code><code>mod_perl</code></code></h2>

<p>Object::InsideOut usage under <a>mod_perl</a> and with runtime-loaded classes is supported automatically; no special coding is required.</p>

<p><b>Caveat</b>: Runtime loading of classes should be performed before any objects are created within any of the classes in their hierarchies. If Object::InsideOut cannot create a hierarchy because of previously created objects (even if all those objects have been destroyed), a runtime error will be generated.</p>

<h2 id="Singleton-Classes">Singleton Classes</h2>

<p>A singleton class is a case where you would provide your own <code><code>-&gt;new()</code></code> method that in turn calls Object::InsideOut&#39;s <code><code>-&gt;new()</code></code> method:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">my</span> <span class="variable">$singleton</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> new </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="variable">$thing</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
         <span class="keyword">if</span> <span class="operator">(!</span> <span class="variable">$singleton</span><span class="operator">)</span> <span class="operator">{</span>
             <span class="variable">$singleton</span> <span class="operator">=</span> <span class="variable">$thing</span><span class="operator">-&gt;</span><span class="variable">Object::InsideOut::new</span><span class="operator">(</span><span class="variable">@_</span><span class="operator">);</span>
         <span class="operator">}</span>
         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$singleton</span><span class="operator">);</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<h1 id="DIAGNOSTICS">DIAGNOSTICS</h1>

<p>Object::InsideOut uses <code><code>Exception::Class</code></code> for reporting errors. The base error class for this module is <code><code>OIO</code></code>. Here is an example of the basic manner for trapping and handling errors:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span><span class="operator">;</span>
 <span class="keyword">eval</span> <span class="operator">{</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">My::Class</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span> <span class="operator">};</span>
 <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">my</span> <span class="variable">$e</span> <span class="operator">=</span> <span class="variable">OIO</span><span class="operator">-&gt;</span><span class="variable">caught</span><span class="operator">())</span> <span class="operator">{</span>
     <span class="keyword">warn</span><span class="operator">(</span><span class="string">'Failure creating object: '</span><span class="operator">.</span><span class="variable">$e</span><span class="operator">);</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>A more comprehensive approach might employ elements of the following:</p>

<pre><code><code> <span class="keyword">eval</span> <span class="operator">{</span> <span class="operator">...</span> <span class="operator">};</span>
 <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">my</span> <span class="variable">$e</span> <span class="operator">=</span> <span class="variable">OIO</span><span class="operator">-&gt;</span><span class="variable">caught</span><span class="operator">())</span> <span class="operator">{</span>
     <span class="comment"># An error generated by Object::InsideOut</span>
     <span class="operator">...</span>
 <span class="operator">}</span> <span class="keyword">elsif</span> <span class="operator">(</span><span class="keyword">my</span> <span class="variable">$e</span> <span class="operator">=</span> <span class="variable">Exception::Class::Base</span><span class="operator">-&gt;</span><span class="variable">caught</span><span class="operator">())</span> <span class="operator">{</span>
     <span class="comment"># An error generated by other code that uses Exception::Class</span>
     <span class="operator">...</span>
 <span class="operator">}</span> <span class="keyword">elsif</span> <span class="operator">(</span><span class="variable">$@</span><span class="operator">)</span> <span class="operator">{</span>
     <span class="comment"># An unhandled error (i.e., generated by code that doesn't use</span>
     <span class="comment"># Exception::Class)</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>I have tried to make the messages and information returned by the error objects as informative as possible. Suggested improvements are welcome. Also, please bring to my attention any conditions that you encounter where an error occurs as a result of Object::InsideOut code that doesn&#39;t generate an Exception::Class object. Here is one such error:</p>

<dl>

<dt id="Invalid-ARRAY-HASH-attribute">Invalid ARRAY/HASH attribute</dt>
<dd>

<p>This error indicates you forgot <code><code><span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
</code></code> in your class&#39;s code.</p>

</dd>
</dl>

<p>Object::InsideOut installs a <code><code>__DIE__</code></code> handler (see <a href="../../../lib/pod/perlfunc.html#die-LIST">&quot;die LIST&quot; in perlfunc</a> and <a href="../../../lib/pod/perlfunc.html#eval-BLOCK">&quot;eval BLOCK&quot; in perlfunc</a>) to catch any errant exceptions from class-specific code, namely, <code><code>:Init</code></code>, <code><code>:Replicate</code></code>, <code><code>:Destroy</code></code>, etc. subroutines. When using <code><code>eval</code></code> blocks inside these subroutines, you should localize <code><code><span class="variable">$SIG</span><span class="operator">{</span><span class="string">'__DIE__'</span><span class="operator">}</span>
</code></code> to keep Object::InsideOut&#39;s <code><code>__DIE__</code></code> handler from interfering with exceptions generated inside the <code><code>eval</code></code> blocks. For example:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> _init :Init </span><span class="operator">{</span>
     <span class="operator">...</span>
     <span class="keyword">eval</span> <span class="operator">{</span>
         <span class="keyword">local</span> <span class="variable">$SIG</span><span class="operator">{</span><span class="string">'__DIE__'</span><span class="operator">}</span><span class="operator">;</span>
         <span class="operator">...</span>
     <span class="operator">};</span>
     <span class="keyword">if</span> <span class="variable">$@</span> <span class="operator">{</span>
         <span class="comment"># Handle caught exception</span>
     <span class="operator">}</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Here&#39;s another example, where the <code><code>die</code></code> function is used as a method of flow control for leaving an <code><code>eval</code></code> block:</p>

<pre><code><code> <span class="keyword">eval</span> <span class="operator">{</span>
     <span class="keyword">local</span> <span class="variable">$SIG</span><span class="operator">{</span><span class="string">'__DIE__'</span><span class="operator">}</span><span class="operator">;</span>           <span class="comment"># Suppress any existing __DIE__ handler</span>
     <span class="operator">...</span>
     <span class="keyword">die</span><span class="operator">(</span><span class="operator">{</span><span class="string">'found'</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">}</span><span class="operator">)</span> <span class="keyword">if</span> <span class="variable">$found</span><span class="operator">;</span>   <span class="comment"># Leave the eval block</span>
     <span class="operator">...</span>
 <span class="operator">};</span>
 <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$@</span><span class="operator">)</span> <span class="operator">{</span>
     <span class="keyword">die</span> <span class="keyword">unless</span> <span class="operator">(</span><span class="keyword">ref</span><span class="operator">(</span><span class="variable">$@</span><span class="operator">)</span> <span class="operator">&amp;&amp;</span> <span class="variable">$@</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'found'</span><span class="operator">}</span><span class="operator">);</span>   <span class="comment"># Propagate any 'real' error</span>
     <span class="comment"># Handle 'found' case</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
 <span class="comment"># Handle 'not found' case</span>
</code></code></pre>

<p>Similarly, if calling code from other modules that use the above flow control mechanism, but without localizing <code><code><span class="variable">$SIG</span><span class="operator">{</span><span class="string">'__DIE__'</span><span class="operator">}</span>
</code></code>, you can workaround this deficiency with your own <code><code>eval</code></code> block:</p>

<pre><code><code> <span class="keyword">eval</span> <span class="operator">{</span>
     <span class="keyword">local</span> <span class="variable">$SIG</span><span class="operator">{</span><span class="string">'__DIE__'</span><span class="operator">}</span><span class="operator">;</span>     <span class="comment"># Suppress any existing __DIE__ handler</span>
     <span class="variable">Some::Module::func</span><span class="operator">();</span>      <span class="comment"># Call function that fails to localize</span>
 <span class="operator">};</span>
 <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$@</span><span class="operator">)</span> <span class="operator">{</span>
     <span class="comment"># Handle caught exception</span>
 <span class="operator">}</span>
</code></code></pre>

<p>In addition, you should file a bug report against the offending module along with a patch that adds the missing <span style="white-space: nowrap;"><code><code><span class="keyword">local</span> <span class="variable">$SIG</span><span class="operator">{</span><span class="string">'__DIE__'</span><span class="operator">}</span><span class="operator">;</span>
</code></code></span> statement.</p>

<h1 id="BUGS-AND-LIMITATIONS">BUGS AND LIMITATIONS</h1>

<p>If you receive an error similar to this:</p>

<pre><code><code> ERROR: Attempt to DESTROY object ID 1 of class Foo twice</code></code></pre>

<p>the cause may be that some module used by your application is doing <code><code>require threads</code></code> somewhere in the background. <a href="../../../lib/DBI.html">DBI</a> is one such module. The workaround is to add <code><code><span class="keyword">use</span> <span class="variable">threads</span><span class="operator">;</span>
</code></code> at the start of your application.</p>

<p>Another cause of the above is returning a non-shared object from a thread either explicitly or implicitly when the result of the last statement in the thread subroutine is an object. For example:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> thr_func </span><span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">MyClass</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 <span class="operator">}</span>
</code></code></pre>

<p>which is equivalent to:</p>

<pre><code><code> <span class="keyword">sub</span><span class="variable"> thr_func </span><span class="operator">{</span>
     <span class="keyword">return</span> <span class="variable">MyClass</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 <span class="operator">}</span>
</code></code></pre>

<p>This can be avoided by ensuring your thread subroutine ends with <code><code><span class="keyword">return</span><span class="operator">;</span>
</code></code>.</p>

<p>The equality operator (e.g., <code><code><span class="keyword">if</span> <span class="operator">(</span><span class="variable">$obj1</span> <span class="operator">==</span> <span class="variable">$obj2</span><span class="operator">)</span> <span class="operator">{</span> <span class="operator">...</span>
</code></code>) is overloaded for <code><code>:SHARED</code></code> classes when <a href="../../../lib/threads/shared.html">threads::shared</a> is loaded. The <a href="../../../lib/overload.html">overload</a> subroutine compares object classes and IDs because references to the same thread shared object may have different refaddrs.</p>

<p>You cannot overload an object to a scalar context (i.e., can&#39;t <code><code>:SCALARIFY</code></code>).</p>

<p>You cannot use two instances of the same class with mixed thread object sharing in same application.</p>

<p>Cannot use attributes on <i>subroutine stubs</i> (i.e., forward declaration without later definition) with <code><code>:Automethod</code></code>:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">sub</span><span class="variable"> method :Private</span><span class="operator">;</span>   <span class="comment"># Will not work</span>
 
     <span class="keyword">sub</span><span class="variable"> _automethod :Automethod
     </span><span class="operator">{</span>
         <span class="comment"># Code to handle call to 'method' stub</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>Due to limitations in the Perl parser, the entirety of any one attribute must be on a single line. (However, multiple attributes may appear on separate lines.)</p>

<p>If a <i>set</i> accessor accepts scalars, then you can store any inside-out object type in it. If its <code><code>Type</code></code> is set to <code><code>HASH</code></code>, then it can store any <i>blessed hash</i> object.</p>

<p>Returning objects from threads does not work:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">threads</span><span class="operator">-&gt;</span><span class="variable">create</span><span class="operator">(</span><span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">return</span> <span class="operator">(</span><span class="variable">Foo</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">());</span> <span class="operator">})-&gt;</span><span class="variable">join</span><span class="operator">();</span>  <span class="comment"># BAD</span>
</code></code></pre>

<p>Instead, use thread object sharing, create the object before launching the thread, and then manipulate the object inside the thread:</p>

<pre><code><code> <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">Foo</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>   <span class="comment"># Class 'Foo' is set ':SHARED'</span>
 <span class="variable">threads</span><span class="operator">-&gt;</span><span class="variable">create</span><span class="operator">(</span><span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">set_data</span><span class="operator">(</span><span class="string">'bar'</span><span class="operator">);</span> <span class="operator">})-&gt;</span><span class="variable">join</span><span class="operator">();</span>
 <span class="keyword">my</span> <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">get_data</span><span class="operator">();</span>
</code></code></pre>

<p>Due to a limitation in <a href="../../../lib/threads/shared.html">threads::shared</a> version 1.39 and earlier, if storing shared objects inside other shared objects, you should use <code><code>delete()</code></code> to remove them from internal fields (e.g., <code><code><span class="keyword">delete</span><span class="operator">(</span><span class="variable">$field</span><span class="operator">[</span><span class="variable">$$self</span><span class="operator">]</span><span class="operator">);</span>
</code></code>) when necessary so that the objects&#39; destructor gets called. Upgrading to version 1.40 or later alleviates most of this issue except during global destruction. See <a href="#BUGS-AND-LIMITATIONS">threads::shared</a> for more.</p>

<p>With Perl 5.8.8 and earlier, there are bugs associated with <a href="../../../lib/threads/shared.html">threads::shared</a> that may prevent you from storing objects inside of shared objects, or using foreign inheritance with shared objects. With Perl 5.8.9 (and later) together with <a href="../../../lib/threads/shared.html">threads::shared</a> 1.15 (and later), you can store shared objects inside of other shared objects, and you can use foreign inheritance with shared objects (provided the foreign class supports shared objects as well).</p>

<p>Due to internal complexities, the following actions are not supported in code that uses <a href="../../../lib/threads/shared.html">threads::shared</a> while there are any threads active:</p>

<ul>

<li><p>Runtime loading of Object::InsideOut classes</p>

</li>
<li><p>Using <a href="#RUNTIME-INHERITANCE">-&gt;add_class()</a></p>

</li>
</ul>

<p>It is recommended that such activities, if needed, be performed in the main application code before any threads are created (or at least while there are no active threads).</p>

<p>For Perl 5.6.0 through 5.8.0, a Perl bug prevents package variables (e.g., object attribute arrays/hashes) from being referenced properly from subroutine refs returned by an <code><code>:Automethod</code></code> subroutine. For Perl 5.8.0 there is no workaround: This bug causes Perl to core dump. For Perl 5.6.0 through 5.6.2, the workaround is to create a ref to the required variable inside the <code><code>:Automethod</code></code> subroutine, and use that inside the subroutine ref:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">My::Class</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span><span class="operator">;</span>
 
     <span class="keyword">my</span> <span class="variable">%data</span><span class="operator">;</span>
 
     <span class="keyword">sub</span><span class="variable"> auto :Automethod
     </span><span class="operator">{</span>
         <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">;</span>
         <span class="keyword">my</span> <span class="variable">$name</span> <span class="operator">=</span> <span class="variable">$_</span><span class="operator">;</span>
 
         <span class="keyword">my</span> <span class="variable">$data</span> <span class="operator">=</span> <span class="operator">\</span><span class="variable">%data</span><span class="operator">;</span>      <span class="comment"># Workaround for 5.6.X bug</span>
 
         <span class="keyword">return</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
                     <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
                     <span class="keyword">if</span> <span class="operator">(!</span> <span class="variable">@_</span><span class="operator">)</span> <span class="operator">{</span>
                         <span class="keyword">return</span> <span class="operator">(</span><span class="variable">$$data</span><span class="operator">{</span><span class="variable">$name</span><span class="operator">}</span><span class="operator">);</span>
                     <span class="operator">}</span>
                     <span class="variable">$$data</span><span class="operator">{</span><span class="variable">$name</span><span class="operator">}</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
                <span class="operator">};</span>
     <span class="operator">}</span>
 <span class="operator">}</span>
</code></code></pre>

<p>For Perl 5.8.1 through 5.8.4, a Perl bug produces spurious warning messages when threads are destroyed. These messages are innocuous, and can be suppressed by adding the following to your application code:</p>

<pre><code><code> <span class="variable">$SIG</span><span class="operator">{</span><span class="string">'__WARN__'</span><span class="operator">}</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
         <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span> <span class="operator">!~</span> <span class="regex">/^Attempt to free unreferenced scalar/</span><span class="operator">)</span> <span class="operator">{</span>
             <span class="keyword">print</span><span class="operator">(</span><span class="variable">STDERR</span> <span class="variable">@_</span><span class="operator">);</span>
         <span class="operator">}</span>
     <span class="operator">};</span>
</code></code></pre>

<p>A better solution would be to upgrade <a href="../../../lib/threads.html">threads</a> and <a href="../../../lib/threads/shared.html">threads::shared</a> from CPAN, especially if you encounter other problems associated with threads.</p>

<p>For Perl 5.8.4 and 5.8.5, the <a href="#Storable">&quot;Storable&quot;</a> feature does not work due to a Perl bug. Use Object::InsideOut v1.33 if needed.</p>

<p>Due to bugs in the Perl interpreter, using the introspection API (i.e. <code><code>-&gt;meta()</code></code>, etc.) requires Perl 5.8.0 or later.</p>

<p>The version of <a href="../../../lib/perl5/x86_64-linux-thread-multi/Want.html">Want</a> that is available via PPM for ActivePerl is defective, and causes failures when using <code><code>:lvalue</code></code> accessors. Remove it, and then download and install the <a href="../../../lib/perl5/x86_64-linux-thread-multi/Want.html">Want</a> module using CPAN.</p>

<p><a href="../../../lib/Devel/StackTrace.html">Devel::StackTrace</a> (used by <a href="../../../lib/Exception/Class.html">Exception::Class</a>) makes use of the <i>DB</i> namespace. As a consequence, Object::InsideOut thinks that <span style="white-space: nowrap;"><code><code>package DB</code></code></span> is already loaded. Therefore, if you create a class called <i>DB</i> that is sub-classed by other packages, you may need to <code><code>require</code></code> it as follows:</p>

<pre><code><code> <span class="keyword">package</span> <span class="variable">DB::Sub</span><span class="operator">;</span> <span class="operator">{</span>
     <span class="keyword">require</span> <span class="variable">DB</span><span class="operator">;</span>
     <span class="keyword">use</span> <span class="variable">Object::InsideOut</span> <span class="string">qw(DB)</span><span class="operator">;</span>
     <span class="operator">...</span>
 <span class="operator">}</span>
</code></code></pre>

<p>View existing bug reports at, and submit any new bugs, problems, patches, etc. to: <a href="http://rt.cpan.org/Public/Dist/Display.html?Name=Object-InsideOut">http://rt.cpan.org/Public/Dist/Display.html?Name=Object-InsideOut</a></p>

<h1 id="REQUIREMENTS">REQUIREMENTS</h1>

<dl>

<dt id="Perl-5.6.0-or-later">Perl 5.6.0 or later</dt>
<dd>

</dd>
<dt id="Exception::Class-v1.22-or-later"><a href="../../../lib/Exception/Class.html">Exception::Class</a> v1.22 or later</dt>
<dd>

</dd>
<dt id="Scalar::Util-v1.10-or-later"><a href="../../../lib/Scalar/Util.html">Scalar::Util</a> v1.10 or later</dt>
<dd>

<p>It is possible to install a <i>pure perl</i> version of Scalar::Util, however, it will be missing the <a href="../../../lib/Scalar/Util.html#weaken-REF">weaken()</a> function which is needed by Object::InsideOut. You&#39;ll need to upgrade your version of Scalar::Util to one that supports its <code><code>XS</code></code> code.</p>

</dd>
<dt id="Test::More-v0.50-or-later"><a href="../../../lib/Test/More.html">Test::More</a> v0.50 or later</dt>
<dd>

<p>Needed for testing during installation.</p>

</dd>
<dt id="Want-v0.12-or-later"><a href="../../../lib/perl5/x86_64-linux-thread-multi/Want.html">Want</a> v0.12 or later</dt>
<dd>

<p>Optional. Provides support for <a href="#lvalue-Accessors">&quot;:lvalue Accessors&quot;</a>.</p>

</dd>
<dt id="Math::Random::MT::Auto-v5.04-or-later-"><a>Math::Random::MT::Auto</a> v5.04 or later)</dt>
<dd>

<p>Optional. Provides support for <a href="#SECURITY">:SECURE mode</a>.</p>

</dd>
</dl>

<p>To cover all of the above requirements and more, it is recommended that you install <a href="../../../../../../public/home/fxing/.cpan/build/Object-InsideOut-3.98-wuUVde/blib/lib/Bundle/Object/InsideOut.html">Bundle::Object::InsideOut</a> using CPAN:</p>

<pre><code><code> perl -MCPAN -e &#39;install Bundle::Object::InsideOut&#39;</code></code></pre>

<p>This will install the latest versions of all the required and optional modules needed for full support of all of the features provided by Object::InsideOut.</p>

<h1 id="SEE-ALSO">SEE ALSO</h1>

<p>Object::InsideOut Discussion Forum on CPAN: <a href="http://www.cpanforum.com/dist/Object-InsideOut">http://www.cpanforum.com/dist/Object-InsideOut</a></p>

<p>Inside-out Object Model: <a href="http://www.perlfoundation.org/perl5/index.cgi?inside_out_object">http://www.perlfoundation.org/perl5/index.cgi?inside_out_object</a>, <a href="http://www.perlmonks.org/?node_id=219378">http://www.perlmonks.org/?node_id=219378</a>, <a href="http://www.perlmonks.org/?node_id=483162">http://www.perlmonks.org/?node_id=483162</a>, <a href="http://www.perlmonks.org/?node_id=515650">http://www.perlmonks.org/?node_id=515650</a>, Chapters 15 and 16 of <i>Perl Best Practices</i> by Damian Conway</p>

<p><a href="../../../../../../public/home/fxing/.cpan/build/Object-InsideOut-3.98-wuUVde/blib/lib/Object/InsideOut/Metadata.html">Object::InsideOut::Metadata</a></p>

<p><a href="../../../lib/Storable.html">Storable</a>, <a href="Exception:Class">Exception:Class</a>, <a href="../../../lib/perl5/x86_64-linux-thread-multi/Want.html">Want</a>, <a>Math::Random::MT::Auto</a>, <a href="../../../lib/attributes.html">attributes</a>, <a href="../../../lib/overload.html">overload</a></p>

<h1 id="ACKNOWLEDGEMENTS">ACKNOWLEDGEMENTS</h1>

<p>Abigail <span style="white-space: nowrap;">&lt;perl AT abigail DOT nl&gt;</span> for inside-out objects in general.</p>

<p>Damian Conway <span style="white-space: nowrap;">&lt;dconway AT cpan DOT org&gt;</span> for <a>Class::Std</a>, and for delegator methods.</p>

<p>David A. Golden <span style="white-space: nowrap;">&lt;dagolden AT cpan DOT org&gt;</span> for thread handling for inside-out objects.</p>

<p>Dan Kubb <span style="white-space: nowrap;">&lt;dan.kubb-cpan AT autopilotmarketing DOT com&gt;</span> for <code><code>:Chained</code></code> methods.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Jerry D. Hedden, <span style="white-space: nowrap;">&lt;jdhedden AT cpan DOT org&gt;</span></p>

<h1 id="COPYRIGHT-AND-LICENSE">COPYRIGHT AND LICENSE</h1>

<p>Copyright 2005 - 2012 Jerry D. Hedden. All rights reserved.</p>

<p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<h1 id="TRANSLATIONS">TRANSLATIONS</h1>

<p>A Japanese translation of this documentation by TSUJII, Naofumi <span style="white-space: nowrap;">&lt;tsun DOT nt AT gmail DOT com&gt;</span> is available at <a href="http://perldoc.jp/docs/modules/">http://perldoc.jp/docs/modules/</a>.</p>


</body>

</html>


